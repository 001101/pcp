#!/bin/sh
# Handle Bison version issues for derive_parser.y
#

b_version=`bison --version | sed -n -e '/^bison/s/.*)  *//p'`

if [ -z "$b_version" ]
then
    echo "Arrgh ... cannot get bison version from ..."
    bison --version
    exit 1
fi

if [ ! -f derive_parser.y.in ]
then
    echo "Arrgh ... cannot find derive_parser.y.in"
    exit 1
fi

case "$b_version"
in
    2.[0-5]*)
	rm -f derive_parser.y
	sed -e 's/^PUT-PREFIX-DECL-HERE.*/%name-prefix "derive_"/' <derive_parser.y.in >derive_parser.y
	;;
    2.[6-9]*|3.*)
	sed -e 's/^PUT-PREFIX-DECL-HERE.*/%define api.prefix {derive_}/' <derive_parser.y.in >derive_parser.y
	;;
    *)
	echo "Arrgh ... don't know what to do with bison version $b_version"
	exit 1
	;;
esac

exit 0
