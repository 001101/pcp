#! /bin/sh
# PCP QA Test No. 433
# $Revision: 1.12 $
# Test pmie bug #573184
#
#
# Copyright (c) 1995-2002 Silicon Graphics, Inc.  All Rights Reserved.
#
# creator
owner=chatz

seq=`basename $0`
echo "QA output created by $seq"

# get standard filters
. ./common.product
. ./common.filter
. ./common.check

tmp=/tmp/$$
sudo=`pwd`/sudo
status=1	# failure is the default!
trap "rm -f $tmp.*; exit \$status" 0 1 2 3 15

_filter()
{
    _show_pmie_errors | sort | sed -e 's/"//g' -e 's/note - //g'
}

# real QA test starts here

[ -f core ] && ./sudo rm -f core
    
cat << end-of-file > $tmp.conf
delta = 1 sec;
(\$day_of_week >= 1 && \$day_of_week <= 5) && (\$hour >= 7 && \$hour <= 18) &&
some_host (
    30 %_sample irix.disk.all.read :omen  @0..9 > 0 )
-> print "Disk reads on %h";
end-of-file

pmie -z -a src-oss/573184 $tmp.conf >$tmp.out 2>$tmp.err
cat $tmp.out $tmp.err | _filter

if [ -f core ]
then
    mv core $seq.core
    echo "core file moved to $seq.core"
    exit
fi

# success, all done
status=0
exit
