<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<!--
 (c) Copyright 2000-2004 Silicon Graphics Inc. All rights reserved.
 Permission is granted to copy, distribute, and/or modify this document
 under the terms of the Creative Commons Attribution-Share Alike, Version
 3.0 or any later version published by the Creative Commons Corp. A copy
 of the license is available at
 http://creativecommons.org/licenses/by-sa/3.0/us/ .
-->
<HTML>
<HEAD>
    <TITLE>Performance Co-Pilot Tutorial - Archive log management</TITLE>
</HEAD>
<BODY BGCOLOR="#ffffff">
<H1>
<IMG SRC="images/CorpID.gif" ALIGN="MIDDLE">
<IMG SRC="images/smallpcp.gif" ALIGN="RIGHT">
</H1>
<H1>
PCP Tutorial</H1>
<HR>
<H2>
Archive log management</H2>
<P>
<B>URL</B>: file:/var/pcp/Tutorial/archive.html </P>
<HR>
<P>
This chapter of the Performance Co-Pilot Tutorial covers PCP tools for
creating and managing PCP archive logs.</P>
<P>
For an explanation of Performance Co-Pilot terms and acronyms, consult 
the <A HREF="glossary.html">PCP glossary</A>.</P>
<P>
<font color="purple"><H4>NOTE:</H4></font></P>
<P>
Before you start working through this chapter of the tutorial make
sure the following prerequisites have been satisfied:
<UL>
    <LI>
    the products <b>pcp_eoe</b> and <b>pcp</b> are installed on the
    local workstation
    <LI>
    a PCP Monitor License is installed on the local workstation
    <LI>
    the shell variable <TT>$pmcd_host</TT> is set to the name of the
    host which has a PCP Collector License and where <i>pmcd</i>(1)
    is running
    (this is only necessary if you intend to use cut-n-paste to run
    the <FONT COLOR="#ff0000">Show Me</FONT> examples)
    <LI>
    the shell variable <TT>$archive_dir</TT> is set to
    <i>/var/pcp/Tutorial/Archives</i>
    (this is only necessary if you intend to use cut-n-paste to run
    the <FONT COLOR="#ff0000">Show Me</FONT> examples)
</UL>
For more information about the prerequisites mentioned above see
the <A HREF="index.html">Introduction</A> chapter of the tutorial.
</P>
<H4>
Chapter Contents</H4>
<UL>
    <LI>
    <A HREF="#primary">Overview</A> 
    <LI>
    <A HREF="#primary">Primary Logger</A> 
    <LI>
    <A HREF="#other">Other Logger Instances</A> 
    <LI>
    <A HREF="#create">Creating and Replaying PCP Archive Logs</A> 
    <LI>
    <A HREF="#folios">PCP Archive Folios</A> 
    <LI>
    <A HREF="#control">Controlling <I>pmlogger</I></A> 
    <LI>
    <A HREF="#mgnt">Management of PCP Archives</A> 
</UL>
<HR>
<H3>
<A NAME="overview">Overview</I></A></H3>
<P>
The Performance Co-Pilot includes many facilities for creating and 
replaying archive logs that capture performance information.</P>
<P>
For all PCP monitoring tools, metrics values may come from a real-time 
feed (i.e. from <I>pmcd</I> on some host), or from an archive log.</P>
<P>
Users have complete control of what metrics are collected, how often 
and in which logs.  These decisions can be changed dynamically.</P>
<HR>
<H3>
<A NAME="primary">Primary</A> Logger</H3>
<P>
The primary instance of the PCP archive logger (<I>pmlogger</I>) may be 
started on a collector system each time <I>pmcd</I> is started. </P>
<P>
This action is controlled by the chkconfig option `pmlogger'. To turn it 
on, as <B>root</B> do the following:</P>
<P>
<TT># chkconfig pmlogger on</TT></BR>
<TT># /etc/init.d/pcp start</TT></P>
<P>
The specification for the metrics to be logged, and the frequency of logging
is given in the <A HREF="file:/var/pcp/config/pmlogger/config.default">/var/pcp/config/pmlogger/config.default</A>.</P>
<HR>
<H3>
<A NAME="other">Other</A> Logger Instances</H3>
<P>
Additional instances of <I>pmlogger</I> may be started at any time,
running on either a collector system or a monitor system.</P>
<P>
In all cases, each <I>pmlogger</I> instance will create an archive log
for metrics from a single collector system.</P>
<P>
The initial specification of what to log is given in a configuration file;
the syntax is fully described in the <I>pmlogger</I>(1) man page.</P>
<HR>
<H3>
<A NAME="create">Creating</A> and Replaying PCP Archive Logs</H3>
<P>
Some configuration files are supplied, e.g. to create archive logs 
suitable for the PCP visualization tools.
These may be found in the directory <A HREF="file:/var/pcp/config/pmlogger">
/var/pcp/config/pmlogger</A>.</P>
<P>
A simple example has been provided to illustrate the creation of an 
archive log, and subsequent playback using <I>mpvis</I>.
(All of the PCP monitoring tools accept the command line arguments 
<B>-a </B><TT>archivename</TT> to replay from an archive).</P>
<P>
<H4>
<FONT COLOR="#ff0000">Show Me</FONT></H4>
<PRE>
   $ cd /var/tmp
   $ rm -f myarchive.*
   $ /usr/pcp/bin/pmlogger -h $pmcd_host -T 30sec -t 1sec \
        -c /var/pcp/config/pmlogger/config.mpvis myarchive
   $ ls myarchive.*
   $ mpvis -a myarchive
</PRE>
<UL>
    <LI>
    This starts <I>pmlogger</I> with <B><I>pmcd_host</I></B> as the default
    host from which metrics will be fetched, a logging duration of
    <B>30 seconds</B>, a logging interval of <B>1 second</B>, a configuration
    from the <A HREF="file:/var/pcp/config/pmlogger/config.mpvis">
    /var/pcp/config/pmlogger/config.mpvis</A> file, and
    <I>myarchive</I> as the base name of the output archive.
    <LI>
    Once the archive has been created, the directory listing of
    <I>myarchive.*</I> shows that the archive log created by <I>pmlogger</I>
    is composed of 3 files.
    <LI>
    When <I>mpvis</I> starts up, click the left mouse button on the
    <B><I>Play</I></B> button in the <B>PCP Archive Time Control</B>
    dialog.  <I>mpvis</I> will start replaying values from the archive
    at the same speed at which they were recorded.
    <LI>
    Double click the left mouse button on the <B><I>Play</I></B> button
    in the <B>PCP Archive Time Control</B> dialog.  <I>mpvis</I> should
    now replay the values in a <I>Fast Forward</I> mode until it reaches
    the end of the archive.
    <LI>
    Select the <B>Options->Show Bounds</B> option from the <B>PCP Archive
    Time Control</B> dialog menu bar.  The exposed <B>Archive Time Bounds</B>
    dialog displays the bounds of the archive.  Another way to look at
    the bounds of the archive is by using <I>pmdumplog</I>:
<PRE>
    $ pmdumplog -l myarchive
</PRE>
    For more information on <I>pmdumplog</I> refer to the <I>pmdumplog</I>(1)
    man page.
</UL>
</P>
<HR>
<H3>
<A NAME="folios">PCP</A> Archive Folios</H3>
<P>
An archive folio is a named collection of PCP archives. These are 
typically used to provide a convenient way of processing multiple, 
correlated PCP archives.</P>
<P>
Archive folios are created with <I>mkaf</I>.</P>
<P>
The contents of an archive folio can be processed using the <I>pmafm</I>
utility.</P>
<P>
A simple example has been provided to illustrate the creation and
subsequent processing of a folio.</P>
<P>
<H4>
<FONT COLOR="#ff0000">Show Me</FONT></H4>
<PRE>
   $ cd /var/tmp
   $ /usr/pcp/bin/mkaf $archive_dir/babylon.percpu.0 \
       $archive_dir/babylon.perdisk.0 > myfolio
   $ pmafm myfolio list
   $ pmafm myfolio pmdumplog -l
</PRE>
<UL>
    <LI>
    The <I>mkaf</I> creates a folio called <B><I>myfolio</I></B> which
    includes the archives <I>babylon.percpu</I> and <I>babylon.perdisk</I>.
    Note that the archives are not changed in any way, and a new archive
    is not created.
    <LI>
    The <I>pmafm</I> tool may now be used to perform different operations
    on the folio <B><I>myfolio</I></B>, such as listing the folio contents,
    or using other tools to open the archive logs contained in the folio.
    If <I>pmafm</I> is given a folio name but no arguments, it will run
    in interactive mode.
</UL>
</P>
<P>
For more information on folios refer to the <I>mkaf</I>(1) and
<I>pmafm</I>(1) man pages.</P>
<HR>
<H3>
<A NAME="control">Controlling</A> <I>pmlogger</I></H3>
<P>
The <I>pmlc</I> utility may be used to interrogate any <I>pmlogger</I>
instance running either locally or remotely.  Use <I>pmlc</I> to</P>
<UL>
    <LI>
    add or delete metrics or metric instances to be logged
    <LI>
    change the logging frequency for selected metrics
</UL>
<P>
The line-oriented command interface to <I>pmlc</I>(1) is fully described
in the man page.</P>
<HR>
<H3>
<A NAME="mgnt">Management</A> of PCP Archives</H3>
<P>
PCP includes a suite of scripts and tools to automate the collection 
and management of archives.  Refer to the Performance Co-Pilot User's and 
Administrator's Guide for complete details.</P>
<P>
Briefly, these facilities include:</P>
<UL>
    <LI>
    daily log rotation (<I>pmlogger_daily</I>(1))
    <LI>
    archive log merging (<I>pmlogextract</I>(1))
    <LI>
    automatic restarting of failed <I>pmlogger</I> instances
    (<I>pmlogger_check</I>(1))
    <LI>
    creation of snapshots from archives (<I>pmsnap</I>(1))
    <LI>
    maintenance of archive folios for active archives
    (<I>mkaf</I>(1) and <I>pmafm</I>(1))
</UL>
<HR>
<P>
This chapter is complete, you may return to the <A
 HREF="index.html#contents">Tutorial Contents</A> in the introductory 
chapter. </P>
</BODY>
</HTML>
