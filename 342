#!/bin/sh
# PCP QA Test No. 342
# dbpmda with new open socket command
#
# Copyright (c) 2010 Ken McDonell.  All Rights Reserved.
#

# get standard environment, filters and checks
. ./common.product
. ./common.filter
. ./common.check

seq=`basename $0`

echo "QA output created by $seq"

status=0	# success is the default!
$sudo rm -rf $tmp.* $seq.full
trap "rm -f $tmp.*; exit \$status" 0 1 2 3 15

_filter()
{
    _filter_dumpresult \
    | sed -e "s;$tmp.socket;MYSOCKET;"
}

# real QA test starts here
$PCP_PMDAS_DIR/sample/pmdasample -d 29 -l $tmp.log -u $tmp.socket &

cat <<End-of-File | dbpmda -ie 2>&1 | _filter
open socket $tmp.socket
getdesc on
fetch sample.colour
desc sample.colour
profile 29.1 none
profile 29.1 add 2
fetch sample.colour
End-of-File

# success, all done
exit
