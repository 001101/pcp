#!/bin/sh
#
# find metrics in the QA archives
#
# command line args are alternate patterns matched in the output
# from pminfo -d ... so metric names and metric descriptors
#

tmp=/tmp/$$
trap "rm -f $tmp.*; exit 0" 0 1 2 3 15

pat=""
for arg
do
    if [ -z "$pat" ]
    then
	pat="($arg)"
    else
	pat="$pat|($arg)"
    fi
done

rm -f /tmp/eek

for arch in src-oss/*.0
do
    pminfo -a $arch 2>&1 -d \
    | sed -e '/^[a-z]/{
s/$/|/
N
s/$/|/
N
s/|./|/g
s/  */ /g
s/| Data Type: /|/
s/ InDom: /|/
s/ Semantics: /|/
s/ Units: /|/
}' \
| egrep "$pat" >$tmp.out

    if [ -s $tmp.out ]
    then
	pmdumplog -l $arch >$tmp.info
	vers=`sed -n <$tmp.info -e '/Log Format Version/{
s/.*Version //
s/)//
p
}'`
	host=`sed -n <$tmp.info -e '/ from host /{
s/.* from host //
p
}'`
	echo "`basename $arch .0` (V.$vers) host: $host"
	grep commencing $tmp.info
	grep ending $tmp.info
	sed -e 's/^/    /' <$tmp.out
    fi
done
