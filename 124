#! /bin/sh
# PCP QA Test No. 124
# $Revision: 2.10 $
# check that exit status in pmie actions processed correctly
# (problem raised by todd.c.davis@intel.com)
# pv #870661
#
#
# Copyright (c) 1995-2002 Silicon Graphics, Inc.  All Rights Reserved.
#
# creator
owner=kenmcd

seq=`basename $0`

. ./localconfig
if [ $PCP_EOE_VER -lt 2300 -o \( $PCP_EOE_VER -gt 6500 -a $PCP_EOE_VER -lt 6519 \) ]
then
    echo "Requires Linux PCP >= 2.3 or IRIX >= 6.5.19" >$seq.notrun
    echo "$seq: [not run] `cat $seq.notrun`"
    exit 0
fi

echo "QA output created by $seq"

# get standard environment, filters and checks
. ./common.product
. ./common.filter
. ./common.check

tmp=/tmp/$$
here=`pwd`
sudo=$here/sudo
status=0	# success is the default!
$sudo rm -rf $tmp.*
trap "rm -f $tmp.*; exit \$status" 0 1 2 3 15

# real QA test starts here

echo 'hinv.ncpu > 0 -> shell "echo true; true";' | pmie -f -t2 -T1 2>/dev/null
sleep 1

echo 'hinv.ncpu > 0 -> shell "echo true; true" | shell "echo or true; true";' | pmie -f -t2 -T1 2>/dev/null
sleep 1

echo 'hinv.ncpu > 0 -> shell "echo true; true" & shell "echo and true; true";' | pmie -f -t2 -T1 2>/dev/null
sleep 1

echo 'hinv.ncpu > 0 -> shell "echo false; false" | shell "echo or true; true";' | pmie -f -t2 -T1 2>/dev/null
sleep 1

echo 'hinv.ncpu > 0 -> shell "echo false; false" & shell "echo and true; true";' | pmie -f -t2 -T1 2>/dev/null
sleep 1

# success, all done
exit

