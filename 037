#! /bin/sh
# PCP QA Test No. 037
# $Revision: 2.9 $
# exercise meta-data services from an archive
#
# Copyright (c) 1995-2002 Silicon Graphics, Inc.  All Rights Reserved.
#

# format of the line to match ...
# refcnt 2 vol 0 offset 132 (vol 0) serial 1 origin 804982618.523843 delta 5
#
_filter()
{
    sed -e '/^refcnt/s/=/ /g' \
	-e 's/tifd=[0-9]*/tifd=N/g' \
	-e 's/mdfd=[0-9]*/mdfd=N/g' \
	-e 's/mfd=[0-9]*/mfd=N/g' \
    | $PCP_AWK_PROG '
$1 == "refcnt" && $11 == "origin"	{ if (t == 0) {
					    t = $12
					    $12 = "TIME"
					  } 
					  else {
					    if (t == $12)
						$12 = "SAME TIME"
					    else
						$12 = "botch! " t "!=" $12
					  }
					}
					{ print }'
}

seq=`basename $0`
echo "QA output created by $seq"

# get standard filters
. ./common.product
. ./common.filter

tmp=/tmp/$$
trap "rm -f $tmp.*; exit" 0 1 2 3 15

# real QA test starts here
for arch in src-oss/foo src-oss/bar src-oss/mv-foo src-oss/mv-bar src-oss/noti-foo src-oss/noti-bar
do
    echo
    echo "Archive $arch"
    src-oss/xlog -v -a $arch | _filter | src-oss/hex2nbo
done
