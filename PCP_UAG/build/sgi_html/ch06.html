<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type"><title>Chapter 6. Archive Logging</title><meta name="generator" content="DocBook XSL Stylesheets V1.51.1"><meta name="generator" content="SGI XSL DocBook Customization Stylesheets V1.1"><link rel="home" href="index.html" title="Performance Co-Pilot&#8482; for IA-64 Linux User's and Administrator's
Guide"><link rel="up" href="index.html" title="Performance Co-Pilot&#8482; for IA-64 Linux User's and Administrator's
Guide"><link rel="previous" href="ch05.html" title="Chapter 5. Performance Metrics Inference Engine"><link rel="next" href="ch07.html" title="Chapter 7. Performance Co-Pilot Deployment Strategies"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 6. Archive Logging</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch05.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch07.html">Next</a></td></tr></table><hr></div><!--CONTENT_BEGIN--><a name="sgi_start_content"></a><div class="chapter"><div class="titlepage"><div><h2 class="title"><a name="LE93354-PARENT"></a>Chapter 6. Archive Logging</h2></div></div>
<p><a class="indexterm" name="IG31371888239"></a>Performance monitoring and management in complex systems demands
the ability to accurately capture performance characteristics for subsequent
review, analysis, and comparison. Performance Co-Pilot (PCP) provides extensive
support for the creation and management of archive logs that capture a user-specified
profile of performance information to support retrospective performance analysis.
</p>
<p>The following major sections are included in this chapter:</p>
<div class="itemizedlist"><ul type="disc"><li><p><a href="ch06.html#LE43411-PARENT" title="6.1. Introduction to Archive Logging">Section 6.1</a>, presents the concepts and
issues involved with creating and using archive logs.</p>
</li>
<li><p><a href="ch06.html#LE46764-PARENT" title="6.2. Using Archive Logs with Performance Tools">Section 6.2</a>, describes the interaction
of the PCP tools with archive logs.</p>
</li>
<li><p><a href="ch06.html#LE57424-PARENT" title="6.3. Cookbook for Archive Logging">Section 6.3</a>, shows some shortcuts for
setting up useful PCP archive logs.</p>
</li>
<li><p><a href="ch06.html#Z930642977sdc" title="6.4. Other Archive Logging Features and Services">Section 6.4</a>, provides information about
other archive logging features and sevices.</p>
</li>
<li><p><a href="ch06.html#LE80113-PARENT" title="6.5. Archive Logging Troubleshooting">Section 6.5</a>, presents helpful directions
if your archive logging implementation is not functioning correctly.</p>
</li>
</ul></div><div class="section"><div class="titlepage"><div><h2 class="title"><a name="LE43411-PARENT"></a>6.1. Introduction to Archive Logging</h2></div></div>
<p><a class="indexterm" name="ITch07-2"></a>Within the PCP, the <tt>pmlogger
</tt> utility may be configured to collect archives of performance metrics.
The archive creation process is easy and very flexible, incorporating the
following features:</p>
<div class="itemizedlist"><ul type="disc"><li><p>Archive log creation at either a PCP collector (typically
a server) or a PCP monitor system (typically a workstation), or at some designated
PCP archive logger host.</p>
</li>
<li><p>Concurrent independent logging, both local and remote. The
performance analyst can activate a private <tt>pmlogger</tt> instance
to collect only the metrics of interest for the problem at hand, independent
of other logging on the workstation or remote host.</p>
</li>
<li><p>Independent determination of logging frequency for individual
metrics or metric instances. For example, you could log the &#8220;5 minute&#8221;
load average every half hour, the write I/O rate on the DBMS log spindle every
10 seconds, and aggregate I/O rates on the other disks every minute.</p>
</li>
<li><p><a class="indexterm" name="IG31371888240"></a><a class="indexterm" name="IG31371888241"></a>Dynamic adjustment of what
is to be logged, and how frequently, via <tt>pmlc</tt>. This feature
may be used to disable logging or to increase the sample interval during periods
of low activity or chronic high activity (to minimize logging overhead and
intrusion). A local <tt>pmlc</tt> may interrogate and control a
remote <tt>pmlogger</tt>, subject to the access control restrictions
implemented by <tt>pmlogger</tt>.</p>
</li>
<li><p>Self-contained logs that include all system configuration
and metadata required to interpret the values in the log. These logs can be
kept for analysis at a much later time, potentially after the hardware or
software has been reconfigured and the logs have been stored as discrete,
autonomous files for remote analysis.</p>
</li>
<li><p><a class="indexterm" name="IG31371888242"></a><tt>cron</tt>-based scripts to expedite the operational management, for example,
log rotation, consolidation, and culling.</p>
</li>
<li><p><a class="indexterm" name="IG31371888243"></a><a class="indexterm" name="IG31371888244"></a>Archive
folios as a convenient aggregation of multiple archive logs. Archive folios
may be created with the <tt>mkaf</tt> utility and processed with
the <tt>pmafm</tt> tool.</p>
</li>
</ul></div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5206288"></a>6.1.1. Archive Logs and the PMAPI</h3></div></div>
<p><a class="indexterm" name="IG31371888245"></a>Critical to the success of the PCP archive logging scheme is the
fact that the library routines providing access to real-time feeds of performance
metrics also provide access to the archive logs.</p>
<p><a class="indexterm" name="IG31371888246"></a>Live feeds (or real-time) sources of performance metrics and archives
are literally interchangeable, with a single Performance Metrics Application
Programming Interface (PMAPI) that preserves the same semantics for both styles
of metric source. In this way, applications and tools developed against the
PMAPI can automatically process either live or historical performance data.
</p>
<p>The only restriction is that both live and historical data cannot be
monitored simultaneously with the same invocation of a visualization tool.
</p>
</div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5206362"></a>6.1.2. Retrospective Analysis Using Archive Logs</h3></div></div>
<p><a class="indexterm" name="IG31371888247"></a><a class="indexterm" name="IG31371888248"></a>One of the most important applications of archive logging services
provided by PCP is in the area of retrospective analysis. In many cases, understanding
today's performance problems can be assisted by side-by-side comparisons with
yesterday's performance. With routine creation of performance archive logs,
you can concurrently replay pictures of system performance for two or more
periods in the past.</p>
<p>Archive logs are also an invaluable source of intelligence when trying
to diagnose what went wrong, as in a performance postmortem. Because the PCP
archive logs are entirely self-contained, this analysis can be performed off-site
if necessary.</p>
<p>Each archive log contains metric values from only one host. However,
many PCP tools can simultaneously visualize values from multiple archives
collected from different hosts.</p>
<p>The archives can be replayed against the inference engine (<tt>
pmie</tt> is an application that uses the PMAPI). This allows you to
automate the regular, first-level analysis of system performance.</p>
<p>Such analysis can be performed by constructing suitable expressions
to capture the essence of common resource saturation problems, then periodically
creating an archive and playing it against the expressions. For example, you
may wish to create a daily performance audit (run by the <tt>cron</tt>
command) to detect performance regressions.</p>
<p>For more about <tt>pmie</tt>, see <a href="ch05.html" title="Chapter 5. Performance Metrics Inference Engine">Chapter 5, &#8220;Performance Metrics Inference Engine&#8221;</a>.
</p>
</div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5206454"></a>6.1.3. Using Archive Logs for Capacity Planning</h3></div></div>
<p><a class="indexterm" name="IG31371888249"></a><a class="indexterm" name="IG31371888250"></a>By
collecting performance archives with relatively long sampling periods, or
by reducing the daily archives to produce summary logs, the capacity planner
can collect the base data required for forward projections, and can estimate
resource demands and explore &#8220;what if&#8221; scenarios by replaying
data using visualization tools and the inference engine.</p>
</div></div><div class="section"><div class="titlepage"><div><h2 class="title"><a name="LE46764-PARENT"></a>6.2. Using Archive Logs with Performance Tools</h2></div></div>
<p><a class="indexterm" name="ITch07-4"></a>Most PCP tools default to real-time display of current values
for performance metrics from PCP collector host(s). However, most PCP tools
also have the capability to display values for performance metrics retrieved
from PCP archive log(s). The following sections describe plans, steps, and
general issues involving archive logs and the PCP tools.</p>
<div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5206523"></a>6.2.1. Coordination between <tt>pmlogger</tt> and PCP tools</h3></div></div>
<p><a class="indexterm" name="IG31371888251"></a>Most commonly, a PCP tool would be invoked with the <tt>-a</tt> option to process an archive log some time after <tt>pmlogger
</tt> had finished creating the archive. However, a tool such as <tt>
oview</tt> that uses a Time Control dialog (see <a href="ch03.html#LE76997-PARENT" title="3.3. Time Duration and Control">Section 3.3</a><a href="ch03.html#LE76997-PARENT"> in Chapter 3</a>)
stops when the end of archive is reached, but could resume if more data is
written to the PCP archive log.<div class="note"><hr noshade="noshade"><table border="0"><tr><td align="center" valign="top" width="25"><img src="figures/note.png" height="24" width="24"></td><td align="left" valign="top"><b>Note: </b><a class="indexterm" name="IG31371888252"></a><a class="indexterm" name="IG31371888253"></a><a class="indexterm" name="IG31371888254"></a><tt>
pmlogger</tt> uses buffered I/O to write the archive log so that the
end of the archive may be aligned with an I/O buffer boundary, rather than
with a logical archive log record. If such an archive was read by a PCP tool,
it would appear truncated and might confuse the tool. These problems may be
avoided by sending <tt>pmlogger</tt> a <tt>SIGUSR1</tt>
signal, or by using the <tt>flush</tt> command of <tt>pmlc
</tt> to force <tt>pmlogger</tt> to flush its output buffers.

</td></tr></table><hr noshade="noshade"></div><br></p>
</div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5206675"></a>6.2.2. Administering PCP Archive Logs Using <tt>cron</tt> Scripts
</h3></div></div>
<p><a class="indexterm" name="ITch07-6"></a><a class="indexterm" name="IG31371888255"></a>The IRIX operating system supports the
standard <tt>cron</tt> process scheduling system.</p>
<p><a class="indexterm" name="ITch07-7"></a><a class="indexterm" name="IG31371888256"></a><a class="indexterm" name="IG31371888257"></a><a class="indexterm" name="IG31371888258"></a>PCP supplies shell scripts to use
the <tt>cron</tt> functionality to help manage your archive logs.
The following scripts are supplied:</p>
<div class="variablelist"><table border="0" cellspacing="3"><tr valign="top"><td><span class="term"><span class="bold"><b>Script</b></span></span></td><td width="10"> </td><td><p><span class="bold"><b>Description</b></span></p>

</td></tr><tr valign="top"><td><span class="term"><tt>pmlogger_daily</tt></span></td><td width="10"> </td><td><p>Performs a daily housecleaning of archive logs and notices.
</p>

</td></tr><tr valign="top"><td><span class="term"><tt>pmlogger_merge</tt></span></td><td width="10"> </td><td><p><tt></tt>Merges archive logs and is called by <tt>pmlogger_daily</tt>.</p>

</td></tr><tr valign="top"><td><span class="term"><tt>pmlogger_check</tt></span></td><td width="10"> </td><td><p>Checks to see that all desired <tt>pmlogger</tt>
processes are running on your system, and invokes any that are missing for
any reason.</p>

</td></tr><tr valign="top"><td><span class="term"><tt>pmsnap</tt></span></td><td width="10"> </td><td><p>Generates graphic image snapshots of <tt>pmchart</tt>
performance charts at regular intervals.</p>

</td></tr></table></div><p><a class="indexterm" name="IG31371888259"></a>The configuration files used by these scripts can be edited to
suit your particular needs, and are generally controlled by the <tt>
/var/pcp/config/pmlogger/control</tt> file (<tt>pmsnap</tt>
has an additional control file). Complete information on these scripts is
available in the <tt>pmlogger_daily(1)</tt> and <tt>pmsnap(1)</tt> man pages.</p>
</div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="LE92914-PARENT"></a>6.2.3. Archive Log File Management</h3></div></div>
<p><a class="indexterm" name="IG31371888260"></a>PCP archive log files can occupy a great deal of disk
space, and management of archive logs can be a large task in itself. The following
sections provide information to assist you in PCP archive log file management.
</p>
<div class="section"><div class="titlepage"><div><h4 class="title"><a name="id5206941"></a>6.2.3.1. Basename Conventions</h4></div></div>
<p><a class="indexterm" name="IG31371888261"></a>When a
PCP archive is created by <tt>pmlogger</tt>, an archive basename
must be specified and several physical files are created, as shown in <a href="ch06.html#id5206972" title="Table 6-1. Filenames for PCP Archive Log Components (archive.*)">Table 6-1</a>.</p>
<div class="table"><a name="id5206972"></a><p><a name="id5206972"></a><b>Table 6-1. Filenames for PCP Archive Log Components (<tt>archive</tt>.<i>*</i>)</b></p>
<table summary="Filenames for PCP Archive Log Components (archive.*)" border="1"><colgroup><col><col></colgroup><thead><tr valign="top"><th scope="col" align="left" valign="bottom"><p>Filename</p>
</th><th scope="col" align="left" valign="bottom"><p>Contents</p>
</th></tr></thead><tbody><tr valign="top"><td scope="row" align="left" valign="top"><p><tt>archive.</tt><span class="bold"><b></b></span><i>
index</i></p>
</td><td align="left" valign="top"><p>Temporal index for rapid access to
archive contents.</p>
</td></tr><tr valign="top"><td scope="row" align="left" valign="top"><p><tt>archive.</tt><i>
meta</i></p>
</td><td align="left" valign="top"><p>Metadata descriptions for performance
metrics and instance domains appearing in the archive.</p>
</td></tr><tr valign="top"><td scope="row" align="left" valign="top"><p><tt>archive.N</tt></p>
</td><td align="left" valign="top"><p>Volumes of performance metrics values,
for <tt>N</tt> = 0,1,2,...</p>
</td></tr></tbody></table></div><br></div><div class="section"><div class="titlepage"><div><h4 class="title"><a name="id5207181"></a>6.2.3.2. Log Volumes</h4></div></div>
<p><a class="indexterm" name="IG31371888262"></a>A single PCP archive
may be partitioned into a number of volumes. These volumes may expedite management
of the archive; however, the metadata file and at least one volume must be
present before a PCP tool can process the archive.</p>
<p>You can control the size of an archive log volume by using the <tt>-v</tt> command line option to <tt>pmlogger</tt>. This option
specifies how large a volume should become before <tt>pmlogger</tt>
starts a new volume. Archive log volumes retain the same base filename as
other files in the archive log, and are differentiated by a numeric suffix
that is incremented with each volume change. For example, you might have a
log volume sequence that looks like this:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout">netserver.log.0
netserver.log.1
netserver.log.2</pre></td></tr></table><p><a class="indexterm" name="IG31371888263"></a><a class="indexterm" name="IG31371888264"></a>You can
also cause an existing log to be closed and a new one to be opened by sending
a <tt>SIGHUP</tt> signal to <tt>pmlogger</tt>, or by using
the <tt>pmlc</tt> command to change the <tt>pmlogger</tt>
instructions dynamically, without interrupting <tt>pmlogger</tt>
operation. Complete information on log volumes is found in the <tt>
pmlogger(1)</tt> man page.</p>
</div><div class="section"><div class="titlepage"><div><h4 class="title"><a name="id5207300"></a>6.2.3.3. Basenames for Managed Archive Log Files</h4></div></div>
<p>The PCP archive management tools support a consistent scheme for selecting
the basenames for the files in a collection of archives and for mapping these
files to a suitable directory hierarchy.</p>
<p>Once configured, the PCP tools that manage archive logs employ a consistent
scheme for selecting the basename for an archive each time <tt>pmlogger
</tt> is launched, namely the current date and time in the format YYYYMMDD.HH.MM.
Typically, at the end of each day, all archives for a particular host on that
day would be merged to produce a single archive with a basename constructed
from the date, namely YYYYMMDD. The <tt>pmlogger_daily</tt> script
performs this action and a number of other routine housekeeping chores.</p>
</div><div class="section"><div class="titlepage"><div><h4 class="title"><a name="id5207335"></a>6.2.3.4. Directory Organization for Archive Log Files</h4></div></div>
<p>If you are using a deployment of PCP tools and daemons to collect metrics
from a variety of hosts and storing them all at a central location, you should
develop an organized strategy for storing and naming your log files.</p>
<div class="note"><hr noshade="noshade"><table border="0"><tr><td align="center" valign="top" width="25"><img src="figures/note.png" height="24" width="24"></td><td align="left" valign="top"><b>Note: </b><a class="indexterm" name="IG31371888265"></a>There are many possible configurations of <tt>
pmlogger</tt>, as described in <a href="ch07.html#LE56598-PARENT" title="7.3. PCP Archive Logger Deployment">Section 7.3</a><a href="ch07.html#LE56598-PARENT"> in Chapter 7</a>. The directory
organization described in this section is recommended for any system on which <tt>
pmlogger</tt> is configured for permanent execution (as opposed to short-term
executions, for example, as launched from <tt>pmchart</tt> to record
some performance data of current interest).
</td></tr></table><hr noshade="noshade"></div><p>Typically, the IRIX filesystem structure can be used to reflect the
number of hosts for which a <tt>pmlogger</tt> instance is expected
to be running locally, obviating the need for lengthy and cumbersome filenames.
It makes considerable sense to place all logs for a particular host in a separate
directory named after that host. Because each instance of <tt>pmlogger
</tt> can only log metrics fetched from a single host, this also simplifies
some of the archive log management and administration tasks.</p>
<p>For example, consider the filesystem and naming structure shown in <a href="ch06.html#id5207462" title="Figure 6-1. Archive Log Directory Structure">Figure 6-1</a>.</p>
<div class="figure"><a name="id5207462"></a><p><a name="id5207462"></a><b>Figure 6-1. Archive Log Directory Structure</b></p>
<div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0"><tr><td><img src="figures/a12222.gif" alt="Archive Log Directory Structure" height="415" width="618"></td></tr></table></div></div><p><a class="indexterm" name="IG31371888266"></a>The specification of where to place the archive log files for
particular <tt>pmlogger</tt> instances is encoded in the configuration
file <tt>/var/pcp/config/pmlogger/control</tt>,
and this file should be customized on each host running an instance of <tt>
pmlogger</tt>.</p>
<p>If many archives are being created, and the associated PCP collector
systems form peer classes based upon service type (for example, Web servers,
DBMS servers, NFS servers, and so on), then it may be appropriate to introduce
another layer into the directory structure, or use symbolic links to group
together hosts providing similar service types.</p>
</div><div class="section"><div class="titlepage"><div><h4 class="title"><a name="id5207540"></a>6.2.3.5. Configuration of <tt>pmlogger</tt></h4></div></div>
<p><a class="indexterm" name="IG31371888267"></a>The configuration files used by <tt>pmlogger
</tt> describe which metrics are to be logged. Groups of metrics may
be logged at different intervals to other groups of metrics. Two states, mandatory
and advisory, also apply to each group of metrics, defining whether metrics
definitely should be logged or not logged, or whether a later advisory definition
may change that state.</p>
<p>The mandatory state takes precedence if it is <tt>on</tt>
or <tt>off</tt>, causing any subsequent request for a change in
advisory state to have no effect. If the mandatory state is <tt>maybe</tt>, then the advisory state determines if logging is enabled or not.
</p>
<p>The mandatory states are <tt>on</tt>, <tt>off</tt>,
and <tt>maybe</tt>. The advisory states, which only affect metrics
that are mandatory <tt>maybe</tt>, are <tt>on</tt> and <tt>off</tt>. Therefore, a metric that is mandatory <tt>maybe</tt>
in one definition and advisory <tt>on</tt> in another definition
would be logged at the advisory interval. Metrics that are not specified in
the <tt>pmlogger</tt> configuration file are mandatory <tt>maybe</tt> and advisory <tt>off</tt> by default and are not
logged.</p>
<p>A complete description of the <tt>pmlogger</tt> configuration
format can be found on the <tt>pmlogger(1)</tt> man
page.</p>
</div><div class="section"><div class="titlepage"><div><h4 class="title"><a name="id5207708"></a>6.2.3.6. PCP Archive Contents</h4></div></div>
<p><a class="indexterm" name="IG31371888268"></a><a class="indexterm" name="IG31371888269"></a>Once a PCP archive log has been created,
the <tt>pmdumplog</tt> utility may be used to display various information
about the contents of the archive. For example, start with the following command:
</p>
<p><tt>pmdumplog -l /var/adm/pcplog/www.sgi.com/960731</tt></p>
<p>It might produce the following output:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout">Log Label (Log Format Version 1)
Performance metrics from host www.sgi.com
     commencing Wed Jul 31 00:16:34.941 1996
     ending     Thu Aug  1 00:18:01.468 1996</pre></td></tr></table><p>The simplest way to discover what performance metrics are contained
within an archive is to use <tt>pminfo</tt> as shown in <a href="ch06.html#Z984165598sdc" title="Example 6-1. Using pminfo to Obtain Archive Information">Example 6-1</a>:
</p>
<div class="example"><a name="Z984165598sdc"></a><p><a name="Z984165598sdc"></a><b>Example 6-1. Using <tt>pminfo</tt> to Obtain Archive Information</b></p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><tt>pminfo -a /var/adm/pcplog/www.sgi.com/960731 network.mbuf</tt>
network.mbuf.alloc 
network.mbuf.typealloc
network.mbuf.clustalloc
network.mbuf.clustfree
network.mbuf.failed
network.mbuf.waited
network.mbuf.drained</pre></td></tr></table><br></div><br></div></div></div><div class="section"><div class="titlepage"><div><h2 class="title"><a name="LE57424-PARENT"></a>6.3. Cookbook for Archive Logging</h2></div></div>
<p><a class="indexterm" name="IG31371888270"></a><a class="indexterm" name="IG31371888271"></a>The
following sections present a checklist of tasks that may be performed to enable
PCP archive logging with minimal effort. For a complete explanation, refer
to the other sections in this chapter and the man pages for <tt>pmlogger
</tt> and related tools.</p>
<div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5207850"></a>6.3.1. Primary Logger</h3></div></div>
<p><a class="indexterm" name="IG31371888272"></a>Assume you
wish to activate primary archive logging on the PCP collector host <tt>pluto</tt>. Execute all of the following tasks while logged into <tt>pluto</tt> as the superuser (<tt>root</tt>).</p>
<div class="orderedlist"><ol type="1"><li><p>Create the directory to hold the archive logs:
</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><b><tt>mkdir /var/log/pcp/pmlogger/pluto</tt></b></pre></td></tr></table><br></li>
<li><p>Choose a suitable <tt>pmlogger</tt> configuration
file. Here are some examples:</p>
<div class="itemizedlist"><ul type="disc"><li><p><a class="indexterm" name="IG31371888273"></a>The default configuration: <tt>/var/pcp/config/pmlogger/config.default.</tt></p>
</li>
<li><p><a class="indexterm" name="IG31371888274"></a><a class="indexterm" name="IG31371888275"></a><a class="indexterm" name="IG31371888276"></a><a class="indexterm" name="IG31371888277"></a>A broad summary configuration, sufficient to be used with <tt>
dkvis</tt>, <tt>mpvis</tt>, <tt>nfsvis</tt>, and <tt>
pmkstat</tt>: <tt>/var/pcp/config/pmlogger/config.Summary.</tt></p>
</li>
<li><p><a class="indexterm" name="IG31371888278"></a><a class="indexterm" name="IG31371888279"></a><a class="indexterm" name="IG31371888280"></a>One
of the other <tt>config.*</tt> files in the <tt>/var/pcp/config/pmlogger
</tt> directory, tailored for an application, a PCP add-on product,
a <tt>pmchart</tt> view, or a PCP monitor tool.</p>
<p><a class="indexterm" name="IG31371888281"></a>Copy the chosen configuration file to <tt>/var/log/pcp/pmlogger/pluto/config.default
</tt> (possibly after some customization).</p>
</li>
</ul></div></li>
<li><p><a class="indexterm" name="IG31371888282"></a>Edit <tt>/var/pcp/config/pmlogger/control
</tt>. Using the line for the &#8220;local primary logger&#8221; as
a template, add the following line to the file:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><b><tt>pluto  y  n  /var/log/pcp/pmlogger/pluto  -c config.default</tt></b> </pre></td></tr></table><br></li>
<li><p>Make sure PMCD and <tt>pmlogger</tt>
are enabled and running:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><b><tt>chkconfig pmcd on</tt></b>
<b><tt>chkconfig pmlogger on</tt></b>
<b><tt>/etc/rc.d/init.d/pcp start</tt></b>
Performance Co-Pilot PMCD started (logfile is .... /pmcd.log)
Performance Co-Pilot Primary Logger started</pre></td></tr></table><br></li>
<li><p>Verify that the primary <tt>pmlogger</tt>
instance is running:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><b><tt>pmlc</tt></b>
pmlc&gt; <b><tt>connect primary</tt></b>
pmlc&gt; <b><tt>status</tt></b>
pmlogger [primary] on host pluto is logging metrics from host pluto
log started      Thu Aug  8 14:33:01 2002 (times in local time)
last log entry   Thu Aug  8 14:34:11 2002
current time     Thu Aug  8 14:36:54 2002
log volume       0
log size         284</pre></td></tr></table><br></li>
<li><p>Verify that the archive files are being created
in the correct place:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><b><tt>ls /var/log/pcp/pmlogger/pluto</tt></b>
960808.14.33.0 
960808.14.33.index
960808.14.33.meta
Latest
pmlogger.log</pre></td></tr></table><br></li>
</ol></div></div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5208266"></a>6.3.2. Other Logger Configurations</h3></div></div>
<p>Assume you wish to create archive logs on the local host for performance
metrics collected from the remote host <tt>bert</tt>. Execute all
of the following tasks while logged into the local host as the superuser (<tt>root</tt>).</p>
<div class="procedure"><a name="id5208288"></a><p><a name="id5208288"></a><b>Procedure 6-1. Creating Archive Logs</b></p><div class="orderedlist"><ol type="1"><li><p>Create the directory to hold the archive logs:
</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><b><tt>mkdir /var/log/pcp/pmlogger/bert</tt></b> </pre></td></tr></table><br></li>
<li><p>Choose a suitable <tt>pmlogger</tt> configuration
file. Here are three examples:</p>
<div class="itemizedlist"><ul type="disc"><li><p><a class="indexterm" name="IG31371888283"></a>The default configuration: <tt>/var/pcp/config/pmlogger/config.default.</tt></p>
</li>
<li><p><a class="indexterm" name="IG31371888284"></a><a class="indexterm" name="IG31371888285"></a><a class="indexterm" name="IG31371888286"></a><a class="indexterm" name="IG31371888287"></a>A broad summary configuration, sufficient to be used with <tt>
dkvis</tt>, <tt>mpvis</tt>, <tt>nfsvis</tt>, and <tt>
pmkstat</tt>: <tt>/var/pcp/config/pmlogger/config.Summary.</tt></p>
</li>
<li><p><a class="indexterm" name="IG31371888288"></a><a class="indexterm" name="IG31371888289"></a>One of the other <tt>config.*</tt> files
in the <tt>/var/pcp/config/pmlogger</tt> directory, tailored for
an application, a PCP add-on product, a <tt>pmchart</tt> view, or
a PCP monitor tool.</p>
<p>Copy the chosen configuration file to <tt>/var/log/pcp/pmlogger/config.default</tt>
(possibly after some customization).</p>
</li>
</ul></div></li>
<li><p>Edit <tt>/var/pcp/config/pmlogger/control.
</tt> Using the line for <tt>remote</tt> as a template, add
the following line to the file:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><b><tt>bert  n  n  /var/log/pcp/pmlogger/bert  -c ./config.default</tt></b></pre></td></tr></table><br></li>
<li><p>Start <tt>pmlogger</tt>:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><b><tt>/usr/share/pcp/bin/pmlogger_check</tt></b>
Restarting pmlogger for host &quot;bert&quot; ..... done</pre></td></tr></table><br></li>
<li><p>Verify that the <tt>pmlogger</tt> instance
is running:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><b><tt>pmlc</tt></b>
pmlc&gt; <b><tt>show loggers</tt></b>
The following pmloggers are running on bert:
        primary (19144)
pmlc&gt; <b><tt>connect 19144</tt></b>
pmlc&gt; <b><tt>status</tt></b>
pmlogger [19144] on host ernie is logging metrics from host bert
log started      Thu Aug  8 10:10:10 2002 (times in local time)
last log entry   Thu Aug  8 14:50:54 2002
current time     Thu Aug  8 14:55:48 2002
log volume       0
log size         256</pre></td></tr></table><br></li>
</ol></div><ol type="1"></ol></div><p>To create archive logs on the local host for performance metrics collected
from multiple remote hosts, repeat the steps in <a href="ch06.html#id5208288" title="Procedure 6-1. Creating Archive Logs">Procedure 6-1</a>
for each remote host.</p>
</div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5208588"></a>6.3.3. Archive Log Administration</h3></div></div>
<p><a class="indexterm" name="IG31371888290"></a>Assume the local host has been set up to create archive
logs of performance metrics collected from one or more hosts (which may be
either the local host or a remote host).</p>
<p>To activate the maintenance and housekeeping scripts for a collection
of archive logs, execute the following tasks while logged into the local host
as the superuser (<tt>root</tt>):</p>
<div class="orderedlist"><ol type="1"><li><p>Augment the <tt>crontab</tt> file
for <tt>root</tt>. For example:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><b><tt>crontab -l &gt;/tmp/foo</tt></b></pre></td></tr></table><br></li>
<li><p>Edit <tt>/tmp/foo</tt>, adding lines
similar to those from <tt>/var/pcp/config/pmlogger/crontab</tt>
for <tt>pmlogger_daily</tt> and <tt>pmlogger_check</tt>;
for example:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"># daily processing of archive logs
10     0     *     *     *    /usr/share/pcp/bin/pmlogger_daily
# every 30 minutes, check pmlogger instances are running
25,55  *     *     *     *    /usr/share/pcp/bin/pmlogger_check</pre></td></tr></table><br></li>
<li><p>Make these changes permanent with this command:
</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><b><tt>crontab &lt;/tmp/foo</tt></b></pre></td></tr></table><br></li>
</ol></div></div></div><div class="section"><div class="titlepage"><div><h2 class="title"><a name="Z930642977sdc"></a>6.4. Other Archive Logging Features and Services</h2></div></div>
<p>Other archive logging features and services include PCP archive folios,
manipulating archive logs, primary logger, and using <tt>pmlc</tt>.
</p>
<div class="section"><div class="titlepage"><div><h3 class="title"><a name="LE73509-PARENT"></a>6.4.1. PCP  Archive Folios</h3></div></div>
<p><a class="indexterm" name="ITch07-9"></a><a class="indexterm" name="IG31371888291"></a><a class="indexterm" name="IG31371888292"></a><a class="indexterm" name="IG31371888293"></a>A
collection of one or more PCP archive logs may be combined with a control
file to produce a PCP archive folio. Archive folios are created using either <tt>mkaf</tt> or the interactive record mode services of various PCP GUI
monitoring tools.</p>
<p><a class="indexterm" name="IG31371888294"></a>The automated archive log management services also create an archive
folio named <tt>Latest</tt> for each managed <tt>pmlogger
</tt> instance, to provide a symbolic name to the most recent archive
log. With reference to <a href="ch06.html#id5207462" title="Figure 6-1. Archive Log Directory Structure">Figure 6-1</a>, this would mean the
creation of the folios <tt>/var/log/pcp/pmlogger/one/Latest</tt>
and <tt>/var/log/pcp/pmlogger/two/Latest</tt>.</p>
<p><a class="indexterm" name="IG31371888295"></a>The <tt>pmafm</tt> utility is completely
described in the <tt>pmafm(1)</tt> man page, and provides
the interactive commands (single commands may also be executed from the command
line) for the following services:</p>
<div class="itemizedlist"><ul type="disc"><li><p>Checking the integrity of the archives in the folio.</p>
</li>
<li><p>Displaying information about the component archives.</p>
</li>
<li><p>Executing PCP tools with their source of performance metrics
assigned concurrently to all of the component archives (where the tool supports
this), or serially executing the PCP tool once per component archive.</p>
</li>
<li><p>If the folio was created by a single PCP monitoring tool,
replaying all of the archives in the folio with that monitoring tool.</p>
</li>
<li><p>Restricting the processing to particular archives, or the
archives associated with particular hosts.</p>
</li>
</ul></div></div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5208950"></a>6.4.2. Manipulating Archive Logs with <tt>pmlogextract</tt></h3></div></div>
<p><a class="indexterm" name="ITch07-10"></a>
The <tt>pmlogextract</tt> tool takes a number of PCP archive logs
from a single host and performs the following tasks:</p>
<div class="itemizedlist"><ul type="disc"><li><p>Merges the archives into a single log, while maintaining the
correct time stamps for all values.</p>
</li>
<li><p>Extracts all metric values within a temporal window that could
encompass several archive logs.</p>
</li>
<li><p>Extracts only a configurable subset of metrics from the archive
logs.</p>
</li>
</ul></div><p>See the <tt>pmlogextract(1)</tt> man page for
full information on this command. It replaces functionality of the <tt>pmlogmerge</tt> tool as of PCP release 2.0.<a class="indexterm" name="ITch07-12"></a></p>
</div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5209027"></a>6.4.3. Primary Logger</h3></div></div>
<p><a class="indexterm" name="ITch07-14"></a><a class="indexterm" name="ITch07-16"></a>On each system for which PMCD is active (each PCP
collector system), there is an option to have a distinguished instance of
the archive logger <tt>pmlogger</tt> (the &#8220;primary&#8221;
logger) launched each time PMCD is started. This may be used to ensure the
creation of minimalist archive logs required for ongoing system management
and capacity planning in the event of failure of a system where a remote <tt>
pmlogger</tt> may be running, or because the preferred archive logger
deployment is to activate <tt>pmlogger</tt> on each PCP collector
system.</p>
<p>Run the following command as superuser on each PCP collector system
where you want to activate the primary <tt>pmlogger</tt>:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><b><tt>chkconfig pmlogger on</tt></b></pre></td></tr></table><p>The primary logger launches the next time PMCD is started. If you wish
this to happen immediately, follow up with this command:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><b><tt>/etc/rc.d/init.d/pcp start</tt></b></pre></td></tr></table><p><a class="indexterm" name="IG31371888296"></a><a class="indexterm" name="IG31371888297"></a>When
it is started in this fashion, the <tt>/etc/config/pmlogger.options
</tt> file provides command line options for <tt>pmlogger</tt>.
In the default setup, this in turn means that the initial logging state and
configuration is specified in the file <tt>/var/pcp/config/pmlogger/config.default</tt>.
Either one or both of these files may be modified to tailor <tt>pmlogger
</tt> operation to the local requirements.</p>
</div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5209191"></a>6.4.4. Using <tt>pmlc</tt></h3></div></div>
<p><a class="indexterm" name="IG31371888298"></a><a class="indexterm" name="ITch07-17"></a>You may tailor <tt>pmlogger
</tt> dynamically with the <tt>pmlc</tt> command. Normally,
the <tt>pmlogger</tt> configuration is read at startup. If you choose
to modify the <tt>config</tt> file to change the parameters under
which <tt>pmlogger</tt> operates, you must stop and restart the
program for your changes to have effect. Alternatively, you may change parameters
whenever required by using the <tt>pmlc</tt> interface.</p>
<p>To run the <tt>pmlc</tt> tool, enter:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><b><tt>pmlc</tt></b></pre></td></tr></table><p>By default, <tt>pmlc</tt> acts on the primary instance of <tt>
pmlogger</tt> on the current host. See the <tt>pmlc
(1)</tt> man page for a description of command line options. When it is
invoked, <tt>pmlc</tt> presents you with a prompt:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout">pmlc&gt; </pre></td></tr></table><p>You may obtain a listing of the available commands by entering a question
mark (?) and pressing <tt>Enter</tt>. You see output similar to that
in <a href="ch06.html#Z984165791sdc" title="Example 6-2. Listing Available Commands
">Example 6-2</a>:</p>
<div class="example"><a name="Z984165791sdc"></a><p><a name="Z984165791sdc"></a><b>Example 6-2. Listing Available Commands
</b></p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout">     show loggers [@&lt;host&gt;]           display &lt;pid&gt;s of running pmloggers
     connect _logger_id [@&lt;host&gt;]     connect to designated pmlogger
     status                           information about connected pmlogger
     query metric-list                show logging state of metrics
     new volume                       start a new log volume
     flush                            flush the log buffers to disk
     log { mandatory | advisory } on &lt;interval&gt; _metric-list
     log { mandatory | advisory } off _metric-list
     log mandatory maybe _metric-list
     timezone local|logger|'&lt;timezone&gt;' change reporting timezone
     help                               print this help message
     quit                               exit from pmlc
     _logger_id   is  primary | &lt;pid&gt; | port &lt;n&gt;
     _metric-list is  _metric-spec | { _metric-spec ... }
     _metric-spec is  &lt;metric-name&gt; | &lt;metric-name&gt; [ &lt;instance&gt; ... ]</pre></td></tr></table><p>Here is an example:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><b><tt>pmlc</tt></b>
pmlc&gt; <b><tt>show loggers @babylon</tt></b>
The following pmloggers are running on babylon:
       primary (1892)
pmlc&gt; <b><tt>connect 1892 @babylon</tt></b>
pmlc&gt; <b><tt>log advisory on 2 secs disk.dev.read</tt></b>
pmlc&gt; <b><tt>query disk.dev</tt></b>
disk.dev.read
       adv  on  nl       5 min  [131073 or &#8220;dks0d1&#8221;]
       adv  on  nl       5 min  [131074 or &#8220;dks0d2&#8221;]
pmlc&gt; <b><tt>quit</tt></b></pre></td></tr></table><br></div><br><div class="note"><hr noshade="noshade"><table border="0"><tr><td align="center" valign="top" width="25"><img src="figures/note.png" height="24" width="24"></td><td align="left" valign="top"><b>Note: </b>Any changes to the set of logged metrics made via <tt>pmlc
</tt> are not saved, and are lost the next time <tt>pmlogger</tt>
is started with the same configuration file. Permanent changes are made by
modifying the <tt>pmlogger</tt> configuration file(s).
</td></tr></table><hr noshade="noshade"></div><p>Refer to the <tt>pmlc(1)</tt> and <tt>
pmlogger(1)</tt> man pages for complete details.</p>
</div></div><div class="section"><div class="titlepage"><div><h2 class="title"><a name="LE80113-PARENT"></a>6.5. Archive Logging Troubleshooting</h2></div></div>
<p><a class="indexterm" name="ITch07-19"></a><a class="indexterm" name="IG31371888299"></a><a class="indexterm" name="IG31371888300"></a>The following
issues concern the creation and use of logs using <tt>pmlogger</tt>.
</p>
<div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5209540"></a>6.5.1. <tt>pmlogger</tt> Cannot Write Log</h3></div></div>
<div class="variablelist"><table border="0" cellspacing="3"><tr valign="top"><td><span class="term">Symptom:</span></td><td width="10"> </td><td><p>The <tt>pmlogger</tt> utility does not start, and
you see this message:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><tt>_pmLogNewFile: &#8220;foo.index&#8221; already exists, not over-written</tt></pre></td></tr></table><br>
</td></tr><tr valign="top"><td><span class="term">Cause:</span></td><td width="10"> </td><td><p>Archive logs are considered sufficiently precious that <tt>
pmlogger</tt> does not empty or overwrite an existing set of archive
log files. The log named <tt>foo</tt> actually consists of the
physical file <tt>foo.index</tt>, <tt>foo.meta</tt>,
and at least one file <tt>foo.N</tt>, where <tt>N</tt>
is in the range 0, 1, 2, 3, and so on.</p>
<p>A message similar to the one above is produced when a new <tt>
pmlogger</tt> instance encounters one of these files already in existence.
</p>

</td></tr><tr valign="top"><td><span class="term">Resolution:</span></td><td width="10"> </td><td><p>If you are sure, remove all of the parts of the archive log.
For example, use the following command:<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><b><tt>rm -f foo.*</tt></b></pre></td></tr></table><br></p>
<p>Then rerun <tt>pmlogger</tt>.</p>

</td></tr></table></div></div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5209654"></a>6.5.2. Cannot Find Log</h3></div></div>
<div class="variablelist"><table border="0" cellspacing="3"><tr valign="top"><td><span class="term">Symptom:</span></td><td width="10"> </td><td><p><a class="indexterm" name="ITch07-23"></a>The <tt>pmdumplog</tt>
utility, or any tool that can read an archive log, displays this message:
</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><tt>Cannot open archive mylog: No such file or directory</tt></pre></td></tr></table><br>
</td></tr><tr valign="top"><td><span class="term">Cause:</span></td><td width="10"> </td><td><p>An archive consists of at least three physical files. If the
base name for the archive is <tt>mylog</tt>, then the archive
actually consists of the physical files <tt>mylog.index</tt>, <tt>
mylog.meta</tt>, and at least one file<tt> mylog.N</tt>,
where <tt>N</tt> is in the range 0, 1, 2, 3, and so on.</p>
<p>The above message is produced if one or more of the files is missing.
</p>

</td></tr><tr valign="top"><td><span class="term">Resolution:</span></td><td width="10"> </td><td><p>Use this command to check which files the utility is trying
to open:</p>
<p><table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><b><tt>ls mylog.*</tt></b></pre></td></tr></table><br></p>
<p>Turn on the internal debug flag <tt>DBG_TRACE_LOG</tt> (<tt>-D</tt> 128) to see which files are being inspected by the <tt>_pmOpenLog</tt> routine as shown in the following example:<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><b><tt>pmdumplog -D 128 -l mylog</tt></b></pre></td></tr></table><br></p>
<p>Locate the missing files and move them all to the same directory, or
remove all of the files that are part of the archive, and recreate the archive
log.</p>

</td></tr></table></div></div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5209840"></a>6.5.3. Primary <tt>pmlogger</tt> Cannot Start</h3></div></div>
<div class="variablelist"><table border="0" cellspacing="3"><tr valign="top"><td><span class="term">Symptom:</span></td><td width="10"> </td><td><p>The primary <tt>pmlogger</tt> cannot be started.
A message like the following appears:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><tt>pmlogger: there is already a primary pmlogger running</tt></pre></td></tr></table><br>
</td></tr><tr valign="top"><td><span class="term">Cause:</span></td><td width="10"> </td><td><p>There is either a primary <tt>pmlogger</tt> already
running, or the previous primary <tt>pmlogger</tt> was terminated
unexpectedly before it could perform its cleanup operations.</p>

</td></tr><tr valign="top"><td><span class="term">Resolution:</span></td><td width="10"> </td><td><p><a class="indexterm" name="IG31371888301"></a><a class="indexterm" name="IG31371888302"></a><a class="indexterm" name="IG31371888303"></a><a class="indexterm" name="IG31371888304"></a>If there is already a primary <tt>pmlogger</tt>
running and you wish to replace it with a new <tt>pmlogger</tt>,
use the <tt>show</tt> command in <tt>pmlc</tt> to determine
the process ID of the primary <tt>pmlogger</tt>. The process ID
of the primary <tt>pmlogger</tt> appears in parentheses after the
word &#8220;primary.&#8221; Send an <tt>SIGINT</tt> signal to the
process to shut it down (use the <tt>kill</tt> command). If the
process does not exist, proceed to the manual cleanup described in the paragraph
below. If the process did exist, it should now be possible to start the new <tt>
pmlogger</tt>.</p>
<p>If <tt>pmlc</tt>'s <tt>show</tt> command displays
a process ID for a process that does not exist, a <tt>pmlogger</tt>
process was terminated before it could clean up. If it was the primary <tt>
pmlogger</tt>, the corresponding control files must be removed before
one can start a new primary <tt>pmlogger</tt>. It is a good idea
to clean up any spurious control files even if they are not for the primary <tt>
pmlogger</tt>.</p>
<p><a class="indexterm" name="IG31371888305"></a>The
control files are kept in <tt>/var/tmp/pmlogger</tt>. A control
file with the process ID of the <tt>pmlogger</tt> as its name is
created when the <tt>pmlogger</tt> is started. In addition, the
primary <tt>pmlogger</tt> creates a symbolic link named <tt>primary</tt> to its control file.</p>
<p>For the primary <tt>pmlogger</tt>, remove both the symbolic
link and the file (corresponding to its process ID) to which the link points.
For other <tt>pmlogger</tt>s, remove just the process ID file. Do
not remove any other files in the directory. If the control file for an active <tt>
pmlogger</tt> is removed, <tt>pmlc</tt> is not able to contact
it.</p>

</td></tr></table></div></div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5210097"></a>6.5.4. Identifying an Active <tt>pmlogger</tt> Process</h3></div></div>
<div class="variablelist"><table border="0" cellspacing="3"><tr valign="top"><td><span class="term">Symptom:</span></td><td width="10"> </td><td><p><a class="indexterm" name="IG31371888306"></a>You
have a PCP archive log that is demonstrably growing, but do not know the identify
of the associated <tt>pmlogger</tt> process.</p>

</td></tr><tr valign="top"><td><span class="term">Cause:</span></td><td width="10"> </td><td><p>The PID is not obvious from the log, or the archive name may
not be obvious from the output of the <tt>ps</tt> command.</p>

</td></tr><tr valign="top"><td><span class="term">Resolution:</span></td><td width="10"> </td><td><p>If the archive basename is <tt>foo</tt>, run the
following commands:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout"><b><tt>pmdumplog -l foo</tt></b>
<tt>Log Label (Log Format Version 1)</tt>
Performance metrics from host gonzo 
     commencing Wed Aug  7 00:10:09.214 1996 
     ending     Wed Aug  7 16:10:09.155 1996 
<b><tt>pminfo -a foo -f pmcd.pmlogger</tt></b> 
pmcd.pmlogger.host
     inst [10728 or &quot;10728&quot;] value &quot;gonzo.melbourne.sgi.com&quot;
pmcd.pmlogger.port
     inst [10728 or &quot;10728&quot;] value 4331
pmcd.pmlogger.archive
     inst [10728 or &quot;10728&quot;] value &quot;<i>/usr/var/adm/pcplog/gonzo/foo</i>&quot;</pre></td></tr></table><p>All of the information describing the creator of the archive is revealed
and, in particular, the instance identifier for the PMCD metrics (<tt>10728</tt> in the example above) is the PID of the <tt>pmlogger
</tt> instance, which may be used to control the process via <tt>
pmlc</tt>.</p>

</td></tr></table></div></div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5210268"></a>6.5.5. Illegal Label Record</h3></div></div>
<div class="variablelist"><table border="0" cellspacing="3"><tr valign="top"><td><span class="term">Symptom:</span></td><td width="10"> </td><td><p><a class="indexterm" name="IG31371888307"></a>PCP
tools report:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout">Illegal label record at start of PCP archive log file.</pre></td></tr></table><br>
</td></tr><tr valign="top"><td><span class="term">Cause:</span></td><td width="10"> </td><td><p>Either you are attempting to read a Version 2 archive with
a PCP 1.<i>x</i> tool, or the archive log has become corrupted.
</p>

</td></tr><tr valign="top"><td><span class="term">Resolution:</span></td><td width="10"> </td><td><p>By default, <tt>pmlogger</tt> in PCP release 2.0
and later generates Version 2 archives that PCP 1.0 to 1.3 tools cannot interpret.
If you must use older tools, pass the <tt>-V 1</tt> option to <tt>
pmlogger</tt>, forcing it to generate Version 1 archives.</p>
<p>If the PCP tools are from PCP release 2.0 or later, then the archive
log may have been corrupted, which can be verified using <tt>pmlogcheck
</tt>. Refer to the <tt>pmlogcheck(1)</tt> man
page.</p>

</td></tr></table></div></div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5210389"></a>6.5.6. Empty Archive Log Files or <tt>pmlogger</tt> Exits Immediately
</h3></div></div>
<div class="variablelist"><a name="Z930351569sdc"></a><table border="0" cellspacing="3"><tr valign="top"><td><span class="term">Symptom:</span></td><td width="10"> </td><td><p>Archive log files are zero size, requested metrics are not
being logged, or <tt>pmlogger</tt> exits immediately with no error
messages.</p>

</td></tr><tr valign="top"><td><span class="term">Cause:</span></td><td width="10"> </td><td><p>Either <tt>pmlogger</tt> encountered errors in the
configuration file or has not flushed its output buffers yet or some (or all)
metrics specified in the <tt>pmlogger</tt> configuration file have
had their state changed to advisory <tt>off</tt> or mandatory <tt>off</tt> via <tt>pmlc</tt>. It is also possible that the logging
interval specified in the <tt>pmlogger</tt> configuration file for
some or all of the metrics is longer than the period of time you have been
waiting since <tt>pmlogger</tt> started.</p>

</td></tr><tr valign="top"><td><span class="term">Resolution:</span></td><td width="10"> </td><td><p>If <tt>pmlogger</tt> exits immediately with no error
messages, check the <tt>pmlogger.log</tt> file in the directory <tt>
pmlogger</tt> was started in for any error messages. If <tt>pmlogger
</tt> has not yet flushed its buffers, enter the following command:<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout">killall -SIGUSR1 pmlogger</pre></td></tr></table><br></p>
<p>Otherwise, use the <tt>status</tt> command for <tt>pmlc
</tt> to interrogate the internal <tt>pmlogger</tt> state of
specific metrics.</p>

</td></tr></table></div></div></div></div><!--CONTENT_END--><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch05.html">Prev</a> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Table of Contents</a></td><td width="40%" align="right"> <a accesskey="n" href="ch07.html">Next</a></td></tr><tr><td width="40%" align="left">Chapter 5. Performance Metrics Inference Engine </td><td width="20%" align="center"> </td><td width="40%" align="right">Chapter 7. Performance Co-Pilot Deployment Strategies </td></tr></table></div></body></html>
