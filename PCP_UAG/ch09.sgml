<!-- Fragment document type declaration subset:
ArborText, Inc., 1988-1997, v.4001
<!DOCTYPE SGIDOCBK PUBLIC "-//Silicon Graphics, Inc.//DTD DocBook V2.3-based Subset V1.5//EN" [
<!ENTITY disclaimer.sgml SYSTEM "frontmatter/disclaimer.sgml">
<!ENTITY o3000 SYSTEM "online/o3000.gif" NDATA gif>
<!ENTITY figure5y SYSTEM "online/figure5y.gif" NDATA gif>
<!ENTITY figure5x SYSTEM "online/figure5x.gif" NDATA gif>
<!ENTITY mpivis SYSTEM "online/mpivis.gif" NDATA gif>
<!ENTITY oview-tool.sgml SYSTEM "oview-tool.sgml">
<!ENTITY glossary.sgml SYSTEM "glossary.sgml">
<!ENTITY chap09.misc.sgml SYSTEM "chap09.misc.sgml">
<!ENTITY chap08.pixie.sgml SYSTEM "chap08.pixie.sgml">
<!ENTITY chap07.prof.sgml SYSTEM "chap07.prof.sgml">
<!ENTITY chap06.ssrun.sgml SYSTEM "chap06.ssrun.sgml">
<!ENTITY chap05.machuse.sgml SYSTEM "chap05.machuse.sgml">
<!ENTITY chap04.exptypes.sgml SYSTEM "chap04.exptypes.sgml">
<!ENTITY chap03.ftut.sgml SYSTEM "chap03.ftut.sgml">
<!ENTITY chap02.ctut.sgml SYSTEM "chap02.ctut.sgml">
<!ENTITY chap01.intro.sgml SYSTEM "chap01.intro.sgml">
<!ENTITY whentouseidmap.sgml SYSTEM "whentouseidmap.sgml">
<!ENTITY nfsintro.sgml SYSTEM "nfsintro.sgml">
<!ENTITY idmapping.sgml SYSTEM "idmapping.sgml">
<!ENTITY chapB.sgml SYSTEM "chapB.sgml">
<!ENTITY chapC.sgml SYSTEM "chapC.sgml">
<!ENTITY chapD.sgml SYSTEM "chapD.sgml">
<!ENTITY chapE.sgml SYSTEM "chapE.sgml">
<!ENTITY chapF.sgml SYSTEM "chapF.sgml">
<!ENTITY chapA.sgml SYSTEM "chapA.sgml">
<!ENTITY chap01.sgml SYSTEM "chap01.sgml">
<!ENTITY chap02.sgml SYSTEM "chap02.sgml">
<!ENTITY chap03.sgml SYSTEM "chap03.sgml">
<!ENTITY chap04.sgml SYSTEM "chap04.sgml">
<!ENTITY a12231 SYSTEM "online/a12231.gif" NDATA gif>
<!ENTITY a12129 SYSTEM "online/a12129.gif" NDATA gif>
<!ENTITY a11363 SYSTEM "online/a11363.gif" NDATA gif>
<!ENTITY a11362 SYSTEM "online/a11362.gif" NDATA gif>
<!ENTITY a10650 SYSTEM "online/a10650.gif" NDATA gif>
<!ENTITY a10209 SYSTEM "online/a10209.gif" NDATA gif>
<!ENTITY a10180 SYSTEM "online/a10180.gif" NDATA gif>
<!ENTITY a10181 SYSTEM "online/a10181.gif" NDATA gif>
<!ENTITY a10195 SYSTEM "online/a10195.gif" NDATA gif>
<!ENTITY a10196 SYSTEM "online/a10196.gif" NDATA gif>
<!ENTITY a10197 SYSTEM "online/a10197.gif" NDATA gif>
<!ENTITY a10198 SYSTEM "online/a10198.gif" NDATA gif>
<!ENTITY a10200 SYSTEM "online/a10200.gif" NDATA gif>
<!ENTITY a10201 SYSTEM "online/a10201.gif" NDATA gif>
<!ENTITY a10206 SYSTEM "online/a10206.gif" NDATA gif>
<!ENTITY a10207 SYSTEM "online/a10207.gif" NDATA gif>
<!ENTITY a10253 SYSTEM "online/a10253.gif" NDATA gif>
<!ENTITY a10254 SYSTEM "online/a10254.gif" NDATA gif>
<!ENTITY a10255 SYSTEM "online/a10255.gif" NDATA gif>
<!ENTITY a10256 SYSTEM "online/a10256.gif" NDATA gif>
<!ENTITY a10257 SYSTEM "online/a10257.gif" NDATA gif>
<!ENTITY a10258 SYSTEM "online/a10258.gif" NDATA gif>
<!ENTITY a10259 SYSTEM "online/a10259.gif" NDATA gif>
<!ENTITY a11427 SYSTEM "online/a11427.gif" NDATA gif>
<!ENTITY a11428 SYSTEM "online/a11428.gif" NDATA gif>
<!ENTITY a11429 SYSTEM "online/a11429.gif" NDATA gif>
<!ENTITY a11430 SYSTEM "online/a11430.gif" NDATA gif>
<!ENTITY a11431 SYSTEM "online/a11431.gif" NDATA gif>
<!ENTITY a11432 SYSTEM "online/a11432.gif" NDATA gif>
<!ENTITY conventions.abbreviation SYSTEM "frontmatter/conventions.abbreviation.sgml">
<!ENTITY collections SYSTEM "dwebcollections.sgml">
<!ENTITY unicos SYSTEM "frontmatter/unicos.sgml">
<!ENTITY trademarks SYSTEM "frontmatter/trademarks.sgml">
<!ENTITY disclaimer SYSTEM "frontmatter/disclaimer.sgml">
<!ENTITY rights SYSTEM "frontmatter/rights.sgml">
<!ENTITY manpage.section SYSTEM "frontmatter/manpage.section.sgml">
<!ENTITY % public.private "INCLUDE">
<!ENTITY % proprietary "IGNORE">
<!ENTITY % private "IGNORE">
<!ENTITY % public "INCLUDE">
<!ENTITY % craysoft "INCLUDE">
<!ENTITY conventions.ellipses SYSTEM "frontmatter/conventions.ellipses.sgml">
<!ENTITY conventions.manpage SYSTEM "frontmatter/conventions.manpage.sgml">
<!ENTITY conventions.variable SYSTEM "frontmatter/conventions.variable.sgml">
<!ENTITY conventions.brackets SYSTEM "frontmatter/conventions.brackets.sgml">
<!ENTITY conventions.command SYSTEM "frontmatter/conventions.command.sgml">
<!ENTITY conventions.userinput SYSTEM "frontmatter/conventions.userinput.sgml">
<!ENTITY machines.craympp SYSTEM "frontmatter/machines.craympp.sgml">
<!ENTITY machines.allcraysystems SYSTEM "frontmatter/machines.allcraysystems.sgml">
<!ENTITY standards SYSTEM "frontmatter/standards.sgml">
<!ENTITY reader.comments SYSTEM "frontmatter/reader.comments.sgml">
<!ENTITY ordering.pubs SYSTEM "frontmatter/ordering.pubs.sgml">
<!ENTITY a12229 SYSTEM "online/a12229.gif" NDATA gif>
<!ENTITY a12228 SYSTEM "online/a12228.gif" NDATA gif>
<!ENTITY a12227 SYSTEM "online/a12227.gif" NDATA gif>
<!ENTITY a12226 SYSTEM "online/a12226.gif" NDATA gif>
<!ENTITY a12225 SYSTEM "online/a12225.gif" NDATA gif>
<!ENTITY a12224 SYSTEM "online/a12224.gif" NDATA gif>
<!ENTITY a12223 SYSTEM "online/a12223.gif" NDATA gif>
<!ENTITY a12222 SYSTEM "online/a12222.gif" NDATA gif>
<!ENTITY a12221 SYSTEM "online/a12221.gif" NDATA gif>
<!ENTITY a12220 SYSTEM "online/a12220.gif" NDATA gif>
<!ENTITY a12219 SYSTEM "online/a12219.gif" NDATA gif>
<!ENTITY a12218 SYSTEM "online/a12218.gif" NDATA gif>
<!ENTITY a12217 SYSTEM "online/a12217.gif" NDATA gif>
<!ENTITY a12216 SYSTEM "online/a12216.gif" NDATA gif>
<!ENTITY a12215 SYSTEM "online/a12215.gif" NDATA gif>
<!ENTITY a12214 SYSTEM "online/a12214.gif" NDATA gif>
<!ENTITY a12213 SYSTEM "online/a12213.gif" NDATA gif>
<!ENTITY a12212 SYSTEM "online/a12212.gif" NDATA gif>
<!ENTITY a12211 SYSTEM "online/a12211.gif" NDATA gif>
<!ENTITY a12210 SYSTEM "online/a12210.gif" NDATA gif>
<!ENTITY a12209 SYSTEM "online/a12209.gif" NDATA gif>
<!ENTITY a12208 SYSTEM "online/a12208.gif" NDATA gif>
<!ENTITY a12207 SYSTEM "online/a12207.gif" NDATA gif>
<!ENTITY a12206 SYSTEM "online/a12206.gif" NDATA gif>
<!ENTITY a12205 SYSTEM "online/a12205.gif" NDATA gif>
<!ENTITY a12204 SYSTEM "online/a12204.gif" NDATA gif>
<!ENTITY a12203 SYSTEM "online/a12203.gif" NDATA gif>
<!ENTITY a12202 SYSTEM "online/a12202.gif" NDATA gif>
<!ENTITY a12201 SYSTEM "online/a12201.gif" NDATA gif>
<!ENTITY a12200 SYSTEM "online/a12200.gif" NDATA gif>
<!ENTITY a12199 SYSTEM "online/a12199.gif" NDATA gif>
<!ENTITY a12198 SYSTEM "online/a12198.gif" NDATA gif>
<!ENTITY a12197 SYSTEM "online/a12197.gif" NDATA gif>
<!ENTITY a12196 SYSTEM "online/a12196.gif" NDATA gif>
<!ENTITY a12195 SYSTEM "online/a12195.gif" NDATA gif>
<!ENTITY a12194 SYSTEM "online/a12194.gif" NDATA gif>
<!ENTITY a12193 SYSTEM "online/a12193.gif" NDATA gif>
<!ENTITY a12192 SYSTEM "online/a12192.gif" NDATA gif>
<!ENTITY a12191 SYSTEM "online/a12191.gif" NDATA gif>
<!ENTITY a12190 SYSTEM "online/a12190.gif" NDATA gif>
<!ENTITY a12189 SYSTEM "online/a12189.gif" NDATA gif>
<!ENTITY % IRIX.intros "IGNORE">
<!ENTITY % UAG "INCLUDE">
<!ENTITY ch01.sgml SYSTEM "ch01.sgml">
<!ENTITY ch02.sgml SYSTEM "ch02.sgml">
<!ENTITY ch03.sgml SYSTEM "ch03.sgml">
<!ENTITY ch04.sgml SYSTEM "ch04.sgml">
<!ENTITY ch05.sgml SYSTEM "ch05.sgml">
<!ENTITY ch06.sgml SYSTEM "ch06.sgml">
<!ENTITY ch07.sgml SYSTEM "ch07.sgml">
<!ENTITY ch08.sgml SYSTEM "ch08.sgml">
<!ENTITY chA.sgml SYSTEM "chA.sgml">
<!ENTITY preface.sgml SYSTEM "preface.sgml">
]>
-->
<?Pub UDT _bookmark _target>
<?Pub UDT _nopagebreak _touchup KeepsKeep="yes" KeepsPrev="no" KeepsNext="no" KeepsBoundary="page">
<chapter id="LE62564-PARENT">
<title id="LE62564-TITLE">Customizing and Extending PCP Services</title>
<para><indexterm><primary>customization</primary><secondary>PCP services</secondary>
</indexterm><indexterm><primary>extensibility</primary></indexterm> Performance
Co-Pilot (PCP) has been developed to be fully extensible. The following sections
summarize the various facilities provided to allow you to extend and customize
PCP for your site:</para>
<itemizedlist>
<listitem><para><xref linkend="LE61335-PARENT">, describes the procedure for
customizing the summary PMDA to export derived metrics formed by aggregation
of base PCP metrics from one or more collector hosts.</para>
</listitem>
<listitem><para><xref linkend="LE80685-PARENT">, describes the various options
available for customizing and extending the basic PCP tools.</para>
</listitem>
<listitem><para><xref linkend="LE50224-PARENT">, covers the concepts and tools
provided for updating the PMNS (Performance Metrics Name Space).</para>
</listitem>
<listitem><para><xref linkend="LE10270-PARENT">, details where to find further
information to assist in the development of new PMDAs to extend the range
of performance metrics available through the PCP infrastructure.</para>
</listitem>
<listitem><para><xref linkend="LE31248-PARENT">, outlines how new tools may
be developed to process performance data from the PCP infrastructure.</para>
</listitem></itemizedlist>
<section id="LE61335-PARENT">
<title id="LE61335-TITLE">PMDA Customization</title>
<para>The generic procedures for installing and activating the optional PMDAs
have been described in <xref linkend="LE43202-PARENT">. In some cases, these
procedures prompt the user for information based upon the local system or
network configuration, application deployment, or processing profile to customize
the PMDA and hence the performance metrics it exports.</para>
<para>The summary PMDA is a special case that warrants further discussion.
</para>
<section id="LE43074-PARENT">
<title id="LE43074-TITLE">Customizing the Summary PMDA</title>
<para><indexterm id="ITch09-1"><primary>PMDA</primary><secondary>customizing
</secondary></indexterm>The summary PMDA exports performance metrics derived
from performance metrics made available by other PMDAs. It is described completely
in the <command sectionref="1">pmdasummary</command> man page.</para>
<para>The summary PMDA consists of two processes:</para>
<deflist>
<deflistentry>
<term><command>pmie</command> process</term>
<listitem><para>Periodically samples the base metrics and compute values for
the derived metrics. This dedicated instance of the PCP <command>pmie</command>
inference engine is launched with special command line arguments by the main
process. See <xref linkend="LE41170-PARENT">, for a complete discussion of
the <command>pmie</command> feature set.</para>
</listitem></deflistentry>
<deflistentry>
<term><literal>main</literal> process</term>
<listitem><para>Reads and buffers the values computed by the <command>pmie
</command> process and makes them available to the Performance Metrics Collection
Daemon (PMCD).</para>
</listitem></deflistentry>
</deflist>
<para>All of the metrics exported by the summary PMDA have a singular instance
and the values are instantaneous; the exported value is the correct value
as of the last time the corresponding expression was evaluated by the <command>
pmie</command> process.</para>
<para>The summary PMDA resides in the <literal>/var/pcp/pmdas/summary</literal>
directory and may be installed with a default configuration by following the
steps described in <xref linkend="LE31599-PARENT">.</para>
<para>Alternatively, you may customize the summary PMDA to export your own
derived performance metrics by following the steps in <xref linkend="Z930683963smg">:
</para>
<procedure><title id="Z930683963smg">Customizing the Summary PMDA</title>
<orderedlist><listitem><para>Check that the symbolic constant <literal>SYSSUMMARY
</literal> is defined in the <filename><?Pub _nolinebreak>/var/pcp/pmns/stdpmid<?Pub /_nolinebreak></filename>
file. If it is not, perform the postinstall update of this file, as superuser:<literallayout>
# cd /var/pcp/pmns
        # ./Make.stdpmid</literallayout></para>
</listitem><listitem><para><indexterm><primary>PMNS</primary><secondary>names
</secondary></indexterm>Choose Performance Metric Name Space (PMNS) names
for the new metrics. These must begin with <literal>summary</literal> and
follow the rules described in the <command sectionref="4">pmns</command> man
page. For example, you might use <literal>summary.fs.cache_write</literal>
and <literal>summary.fs.cache_hit</literal>.</para>
</listitem><listitem><para><indexterm><primary>PMID</primary><secondary>PMNS
names</secondary></indexterm>Edit the <filename>pmns</filename> file in the <literal>
/var/pcp/pmdas/summary</literal> directory to add the new metric names in
the format described in the <command sectionref="4">pmns</command> man page.
You must choose a unique performance metric identifier (PMID) for each metric.
In the <filename>pmns</filename> file, these appear as <literal>SYSSUMMARY:0:x
</literal>. The value of <replaceable>x</replaceable> is arbitrary in the
range 0 to 1023 and unique in this file. Refer to <xref linkend="LE50224-PARENT">,
for a further explanation of the rules governing PMNS updates.</para>
<para>For example:</para>
<literallayout>summary {
          cpu
          disk
          netif
          fs              /*new*/
}
summary.fs {
          cache_write     SYSSUMMARY:0:10
          cache_hit       SYSSUMMARY:0:11
}</literallayout>
</listitem><listitem><para>Use the local test PMNS <literal>root</literal>
and validate that the PMNS changes are correct.</para>
<para>For example, enter this command:</para>
<literallayout><userinput>pminfo -n root -m summary.fs</userinput></literallayout>
<para>You see output similar to the following:</para>
<literallayout>summary.fs.cache_write PMID: 27.0.10
summary.fs.cache_hit PMID: 27.0.11</literallayout>
</listitem><listitem><para>Edit the <filename>/var/pcp/pmdas/summary/expr.pmie
</filename> file to add new <command>pmie</command> expressions. If the name
to the left of the assignment operator (=) is one of the PMNS names, then
the <command>pmie</command> expression to the right will be evaluated and
returned by the summary PMDA. The expression must return a numeric value.
Additional description of the <command>pmie</command> expression syntax may
be found in <xref linkend="LE90227-PARENT">.</para>
<para>For example, consider this expression:</para>
<literallayout>// filesystem buffer cache hit percentages
prefix = "kernel.all.io";          // macro, not exported
summary.fs.cache_write =
                100 - 100 * $prefix.bwrite / $prefix.lwrite;
summary.fs.cache_hit =
                100 - 100 * $prefix.bread / $prefix.lread;</literallayout>
<?Pub _newpage>
</listitem><listitem><para>Run <command>pmie</command> in debug mode to verify
that the expressions are being evaluated correctly, and the values make sense.
</para>
<para>For example, enter this command:</para>
<literallayout><userinput>pmie -t 2sec -v expr.pmie</userinput></literallayout>
<para>You see output similar to the following:</para>
<literallayout>summary.fs.cache_write:      ?
summary.fs.cache_hit:      ?
summary.fs.cache_write:  45.83
summary.fs.cache_hit:   83.2
summary.fs.cache_write:  39.22
summary.fs.cache_hit:  84.51</literallayout>
</listitem><listitem><para>Install the new PMDA.</para>
<para>From the <literal>/var/pcp/pmdas/summary</literal> directory, use this
command:</para>
<literallayout><userinput>./Install</userinput></literallayout>
<para>You see the following output:</para>
<literallayout width="wide">You need to choose an appropriate configuration for installation of
the &ldquo;summary&rdquo; Performance Metrics Domain Agent (PMDA).

collector collect performance statistics on this system
monitor   allow this system to monitor local and/or remote systems
both      collector and monitor configuration for this system

Please enter c(ollector) or m(onitor) or b(oth) [b] <userinput>both</userinput>
Interval between summary expression evaluation (seconds)? [10] <userinput>
10</userinput>
Updating the Performance Metrics Name Space...
Installing pmchart view(s) ...
Terminate PMDA if already installed ...
Installing files ..
Updating the PMCD control file, and notifying PMCD ...
Wait 15 seconds for the agent to initialize ...
Check summary metrics have appeared ... 8 metrics and 8 values</literallayout>
</listitem>
<?Pub _newpage>
<listitem><para>Check the metrics.</para>
<para>For example, enter this command:</para>
<literallayout><userinput>pmval -t 5sec -s 8 summary.fs.cache_write</userinput></literallayout>
<para>You see a response similar to the following:</para>
<literallayout>metric:    summary.fs.cache_write
host:      localhost
semantics: instantaneous value
units:     none
samples:   8
interval:  5.00 sec
63.60132158590308
62.71878646441073
62.71878646441073
58.73968492123031
58.73968492123031
65.33822758259046
65.33822758259046
72.6099706744868</literallayout>
<para>Note that the values are being sampled here by <literal>pmval</literal>
every 5 seconds, but <command>pmie</command> is passing only new values to
the summary PMDA every 10 seconds. Both rates could be changed to suit the
dynamics of your new metrics.</para>
</listitem><listitem><para>You may now create <command>pmchart</command> views, <command>
pmview</command> scenes, and <command>pmlogger</command> configurations to
monitor and archive your new performance metrics.</para>
</listitem></orderedlist>
</procedure>
</section>
</section>
<section id="LE80685-PARENT">
<title id="LE80685-TITLE">PCP Tool Customization</title>
<para><indexterm id="ITch09-2"><primary>PCP</primary><secondary>tool customization
</secondary></indexterm><indexterm><primary>tool customization</primary></indexterm>Performance
Co-Pilot (PCP) has been designed and implemented with a philosophy that embraces
the notion of toolkits and encourages extensibility.</para>
<para>In most cases, the PCP tools provide orthogonal services, based on external
configuration files. It is the creation of new and modified configuration
files that enables PCP users to customize tools quickly and meet the needs
of the local environment, in many cases allowing personal preferences to be
established for individual users on the same PCP monitor system.</para>
<para>The material in this section is intended to act as a checklist of pointers
to detailed documentation found elsewhere in this guide, in the man pages,
and in the files that are made available as part of the PCP installation.
</para>
<section>
<title>Archive Logging Customization</title>
<para><indexterm><primary>archive logs</primary><secondary>customization</secondary>
</indexterm><indexterm><primary>customization</primary><secondary>archive
logs</secondary></indexterm>The PCP archive logger is presented in <xref linkend="LE93354-PARENT">,
and documented in the <command sectionref="1">pmlogger</command> man page.
</para>
<para>The following global files and directories influence the behavior of <command>
pmlogger</command>:</para>
<deflist termlength="nextline" id="Z930367453sdc">
<deflistentry>
<term><filename>/var/pcp/config/pmlogger</filename> </term>
<listitem><para>Enable/disable state for the primary logger facility using
this command:<literallayout><userinput><literal>chkconfig pmlogger on</literal></userinput></literallayout></para>
</listitem></deflistentry>
<deflistentry>
<term><filename>/var/pcp/config/pmlogger/config.default</filename> </term>
<listitem><para>The default <command>pmlogger</command> configuration file
that is used for the primary logger when this facility is enabled.</para>
</listitem></deflistentry>
<deflistentry>
<term><filename>/var/pcp/config/pmlogger/config.view.*</filename> </term>
<listitem><para>Every <command>pmchart</command> view also provides a <command>
pmlogger</command> configuration file that includes each of the performance
metrics used in the view, for example, <filename>/var/pcp/config/pmlogger/config.LoadAvg
</filename> for the LoadAvg view.</para>
</listitem></deflistentry>
<deflistentry>
<term><filename>/var/pcp/config/pmlogger/config.*</filename> </term>
<listitem><para>Every PCP tool with a fixed group of performance metrics contributes
a <command>pmlogger</command> configuration file that includes each of the
performance metrics used in the tool, for example, <filename><?Pub _nolinebreak>/var/pcp/config/pmlogger/config.dkvis<?Pub /_nolinebreak></filename>
for <literal>dkvis</literal>.</para>
</listitem></deflistentry>
<deflistentry>
<term><filename>/var/pcp/config/pmlogger/control</filename> </term>
<listitem><para>Defines which PCP collector hosts require <command>pmlogger
</command> to be launched on the local host, where the configuration file
comes from, where the archive log files should be created, and <command>pmlogger
</command> startup options.</para>
</listitem></deflistentry>
<deflistentry>
<term><filename>/var/pcp/config/pmlogger/crontab</filename> </term>
<listitem><para>Prototype <literal>crontab</literal> entries that may be merged
with the <literal>crontab</literal> entries for <literal>root</literal> to
schedule the periodic execution of the archive log management scripts, for
example, <literal>pmlogger_daily</literal>.</para>
</listitem></deflistentry>
<deflistentry>
<term><filename>/var/log/pcp/pmlogger/somehost</filename> </term>
<listitem><para>The default behavior of the archive log management scripts
create archive log files for the host <replaceable>somehost</replaceable>
in this directory.</para>
</listitem></deflistentry>
<deflistentry>
<term><filename>/var/adm/pcplog/somehost/Latest</filename> </term>
<listitem><para>A PCP archive folio for the most recent archive for the host <replaceable>
somehost</replaceable>. This folio is created and maintained by the <literal>
cron</literal>-driven periodic archive log management scripts, for example, <literal>
pmlogger_check</literal>. Archive folios may be processed with the <literal>
pmafm</literal> tool.</para>
</listitem></deflistentry>
</deflist>
</section>
<section>
<title>Inference Engine Customization</title>
<para><indexterm><primary>inference engine</primary></indexterm><indexterm>
<primary>customization</primary><secondary>inference engine</secondary></indexterm>The
PCP inference engine is presented in <xref linkend="LE21414-PARENT">, and
documented in the <command sectionref="1">pmie</command> man page.</para>
<para>The following global files and directories influence the behavior of <command>
pmie</command>:</para>
<deflist termlength="nextline" id="Z930367570sdc">
<deflistentry>
<term><filename>/var/pcp/config/pmie</filename></term>
<listitem><para>Controls the pmie daemon facility. Enable using this command:<literallayout>
chkconfig pmie on</literallayout></para>
</listitem></deflistentry>
<deflistentry>
<term><filename>/usr/share/pcp/pmie/*</filename></term>
<listitem><para>Example <command>pmie</command> rules that may be used as
a basis for developing local rules.</para>
</listitem></deflistentry>
<deflistentry>
<term><filename>/var/pcp/config/pmie/config.default</filename></term>
<listitem><para>The <command>pmie</command> configuration file that is used
for monitoring the local host when the <command>pmie</command> daemon facility
is enabled in the default configuration. This file is created using <command>
pmieconf</command> the first time the daemon facility is activated.</para>
</listitem></deflistentry>
<deflistentry>
<term><filename>/var/pcp/config/pmieconf/*/*</filename></term>
<listitem><para>Each <command>pmieconf</command> rule definition can be found
below one of these subdirectories.</para>
</listitem></deflistentry>
<deflistentry>
<term><filename>/var/pcp/config/pmie/control</filename></term>
<listitem><para>Defines which PCP collector hosts require a daemon <command>
pmie</command> to be launched on the local host, where the configuration file
comes from, where the <command>pmie</command> log file should be created,
and <command>pmie</command> startup options.</para>
</listitem></deflistentry>
<deflistentry>
<term><filename>/var/pcp/config/pmlogger/crontab</filename></term>
<listitem><para>Prototype <command>crontab</command> entries that may be merged
with the <command>crontab</command> entries for root to schedule the periodic
execution of the <command>pmie_check</command> script, for verifying that <command>
pmie</command> instances are running.</para>
</listitem></deflistentry>
<deflistentry>
<term><filename>/var/adm/pmielog/</filename></term>
<listitem><para>The default behavior of the <filename>/etc/rc.d/init.d/pmie
</filename> startup scripts create <command>pmie</command> log files for the
host in this directory.</para>
</listitem></deflistentry>
</deflist>
<para>The PMCD PMDA exports information about executing <command>pmie</command>
instances and their progress in terms of rule evaluations and action execution
rates.</para>
<deflist id="Z930367675sdc">
<deflistentry>
<term><command>pmie_check</command></term>
<listitem><para>This command is similar to the <command>pmlogger</command>
support script, <command>pmlogger_check</command>.</para>
</listitem></deflistentry>
<deflistentry>
<term><filename>/etc/rc.d/init.d/pmie</filename></term>
<listitem><para>This control file supports the starting and stopping of multiple <command>
pmie</command> instances that are monitoring one or more hosts.</para>
</listitem></deflistentry>
<deflistentry>
<term><filename>/var/tmp/pmie</filename></term>
<listitem><para>The statistics that <command>pmie</command> gathers are maintained
in binary data structure files. These files are in the <filename><?Pub _nolinebreak>/var/tmp/pmie<?Pub /_nolinebreak></filename>
directory.</para>
</listitem></deflistentry>
<deflistentry>
<term><literal>pmcd.pmie</literal> metrics</term>
<listitem><para>If <command>pmie</command> is running on a system with a PCP
collector deployment, the <command>pmcd</command> PMDA exports these metrics
via the <filename>pmcd.pmie</filename> group of metrics.</para>
</listitem></deflistentry>
</deflist>
</section>
</section>
<section id="LE50224-PARENT">
<title id="LE50224-TITLE">PMNS Management</title>
<para><indexterm><primary>PMNS</primary><secondary>management</secondary>
</indexterm>This section describes the syntax, semantics, and processing framework
for the external specification of a Performance Metrics Name Space (PMNS)
as it might be loaded by the PMAPI routine <command>pmLoadNameSpace</command>;
see the <command sectionref="3">pmLoadNameSpace</command> man page.</para>
<para>The PMNS specification is a simple ASCII source file that can be edited
easily. For reasons of efficiency, a binary format is also supported; the
utility <literal>pmnscomp</literal> translates the ASCII source format into
binary format; see the <command sectionref="1">pmnscomp</command> man page.
</para>
<section>
<title>PMNS Processing Framework</title>
<para>The PMNS specification is initially passed through <literal>cpp</literal>.
This means the following facilities may be used in the specification:</para>
<itemizedlist>
<listitem><para>C-style comments</para>
</listitem>
<listitem><para><literal>#include</literal> directives</para>
</listitem>
<listitem><para><literal>#define</literal> directives and macro substitution
</para>
</listitem>
<listitem><para>Conditional processing with <literal>#if</literal>, <literal>
#endif</literal>, and so on</para>
</listitem></itemizedlist>
<para>When <literal>cpp</literal> is executed, the standard include directories
are the current directory and <literal>/var/pcp/pmns</literal>, where some
standard macros and default specifications may be found.</para>
</section>
<section>
<title>PMNS Syntax</title>
<para><indexterm id="ITch09-4"><primary>PMNS</primary><secondary>syntax</secondary>
</indexterm><indexterm><primary>syntax</primary></indexterm>Every PMNS is
tree structured. The paths to the leaf nodes are the performance metric names.
The general syntax for a non-leaf node in PMNS is as follows:</para>
<literallayout>pathname {
name	[pmid]
...
}</literallayout>
<para>Here <literal>pathname</literal> is the full pathname from the root
of the PMNS to this non-leaf node, with each component in the path separated
by a period. The root node for the PMNS has the special name <literal>root
</literal>, but the prefix string <literal>root.</literal> must be omitted
from all other <literal>pathnames</literal>.</para>
<para>For example, refer to the PMNS shown in <xref linkend="LE53436-TITLE">.
The correct pathname for the rightmost non-leaf node is <literal>cpu.util
</literal>, not <literal>root.cpu.util</literal>.</para>
<figure>
<graphic entityref="a12229" scale="NO"></graphic>
<title id="LE53436-TITLE">Small Performance Metrics Name Space (PMNS)</title>
</figure>
<para>Each component in the pathname must begin with an alphabetic character
and be followed by zero or more alphanumeric characters or the underscore
(_) character. For alphabetic characters in a component, uppercase and lowercase
are significant.</para>
<para>Non-leaf nodes in the PMNS may be defined in any order desired. The
descendent nodes are defined by the set of <literal>names</literal>, relative
to the pathname of their parent non-leaf node. For descendent nodes, leaf
nodes have a <literal>pmid</literal> specification, but non-leaf nodes do
not.</para>
<para>The syntax for the <literal>pmid</literal> specification was chosen
to help manage the allocation of Performance Metric IDs (PMIDs) across disjoint
and autonomous domains of administration and implementation. Each <literal>
pmid</literal> consists of three integers separated by colons, for example, <literal>
14:27:11</literal>. This is intended to mirror the implementation hierarchy
of performance metrics. The first integer identifies the domain in which the
performance metric lies. Within a domain, related metrics are often grouped
into clusters. The second integer identifies the cluster, and the third integer,
the metric within the cluster.</para>
<?Pub _newpage>
<para>The PMNS specification for <xref linkend="LE53436-TITLE"> is shown in <xref
linkend="Z984417805sdc">:</para>
<example id="Z928447759sdc"><title id="Z984417805sdc">PMNS Specification</title>
<literallayout>/*
* PMNS Specification
*/
#include &lt;stdpmid>
root {
       network
       cpu
}
#define NETWORK 26
network {
       intrate    `LINUX:NETWORK:1
       packetrate
}
network.packetrate {
       in     LINUX:NETWORK:35
       out    LINUX:NETWORK:36
}
#define CPU 10
cpu {
       syscallrate    LINUX:CPU:10
       util
}
#define USER 20
#define KERNEL 21
#define IDLE 22
cpu.util {
       user    LINUX:CPU:USER
       sys     LINUX:CPU:KERNEL
       idle    LINUX:CPU:IDLE
}</literallayout>
</example>
<para>For complete documentation of the PMNS and associated utilities, see
the <command sectionref="4">pmns</command>, <command sectionref="1">pmnscomp
</command>, <command sectionref="1">pmnsadd</command>, <command sectionref="1">
pmnsdel</command>, and <command sectionref="1">pmnsmerge</command> man pages.
</para>
</section>
</section>
<?Pub _newpage>
<section id="LE10270-PARENT"><?Pub Caret1>
<title id="LE10270-TITLE">PMDA Development</title>
<para><indexterm id="ITch09-5"><primary>PMDA</primary><secondary>development
</secondary></indexterm>Performance Co-Pilot (PCP) is designed to be extensible
at the collector site.</para>
<para>Application developers are encouraged to create new PMDAs to export
performance metrics from the applications and service layers that are particularly
relevant to a specific site, application suite, or processing environment.
</para>
<para>These PMDAs use the routines of the <literal>libpcp_pmda</literal> library,
which is discussed in detail by the <string strname="007-3434"><citetitle>
Performance Co-Pilot Programmer's Guide</citetitle></string>.</para>
<para>Source code for several PMDAs (simple, trivial, and txmon) is provided
in the <literal>pcp.sw.demo</literal> subsystem. When it is installed, all
of the relevant files reside in directories (one per PMDA) below the <filename>
/var/pcp/pmdas</filename> directory.</para>
</section>
<section id="LE31248-PARENT">
<title id="LE31248-TITLE">PCP Tool Development</title>
<para><indexterm id="ITch09-6"><primary>PCP</primary><secondary>tool development
</secondary></indexterm><indexterm><primary>tool development</primary></indexterm>Performance
Co-Pilot (PCP) is designed to be extensible at the monitor site.</para>
<para>Application developers are encouraged to create new PCP client applications
to monitor or display performance metrics in a manner that is particularly
relevant to a specific site, application suite, or processing environment.
</para>
<para>Client applications use the routines of the PMAPI (performance metrics
application programming interface) described in the <string strname="007-3434"><citetitle>
Performance Co-Pilot Programmer's Guide</citetitle></string>.</para>
<para>Source code for a sample PMAPI client (<literal>pmclient</literal>)
is provided in the <filename>pcp.sw.demo</filename> subsystem, and when installed
all of the relevant files reside in <literal><?Pub _nolinebreak>/usr/share/pcp/demos/pmclient<?Pub /_nolinebreak></literal>.
</para>
</section>
</chapter>
<?Pub *0000032848>
