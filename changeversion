#!/bin/sh
#
# Cleanup when going from PCP 3.x to 3.6 or vice versa
#

here=`pwd`
if [ -d $HOME/src/pcp/src/libpcp_fault/src/GNUmakefile ]
then
    # 3.x -> 3.6 make libpcp_fault and <pcp/fault.h>
    #
    cd $HOME/src/pcp
    make pcp.lsm
    ./config.status
    cd src/include
    make
    cd ../libpcp_fault/src
    make
    sudo make install
    make clean
else
    # 3.6 -> 3.x cleanup
    #
    sudo rm -f /usr/lib/libpcp_fault* /usr/include/pcp/fault.h
fi
cd $here

rm -f src-oss/descreqX2 src-oss/torture_logmeta
rm -f src-oss/check_fault_injection src-oss/exercise_fault

cd src-oss
make
cd $here

echo "To check ..."
echo "./check 192 479 480"
