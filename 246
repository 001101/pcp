#! /bin/sh
# PCP QA Test No. 246
# $Revision: 1.12 $
#
# Check hypen in host name for pmdumptext
# (see also 1061)
#
# Copyright (c) 2005 Silicon Graphics, Inc.  All Rights Reserved.

# creator
owner=kenmcd

seq=`basename $0`

if which pmdumptext >/dev/null 2>&1
then
    :
else
    echo "No pmdumptext binary installed" >$seq.notrun
    echo "$seq: [not run] `cat $seq.notrun`"
    exit 0
fi

echo "QA output created by $seq"

# get standard environment, filters and checks
. ./common.product
. ./common.filter
. ./common.check
. ./common.config

if [ -z "$PCPQA_HYPHEN_HOST" ]
then
    echo 'Setup error: $PCPQA_HYPHEN_HOST is not set in ./common.config'
    exit 1
fi

tmp=/tmp/$$
here=`pwd`
sudo=$here/sudo
status=0	# success is the default!
$sudo rm -rf $tmp.*
trap "rm -f $tmp.*; exit \$status" 0 1 2 3 15

host=$PCPQA_HYPHEN_HOST

_filter()
{
    sed \
	-e "s/$host/HYPHEN-HOST/" \
	-e 's/[A-Z][a-z][a-z] [A-Z][a-z][a-z]  *[0-9][0-9]* [0-9][0-9]:[0-9][0-9]:[0-9][0-9]/DATE/'
}

# real QA test starts here

echo
echo "pmdumptext [metric spec on command line]"
pmdumptext -t 0.5 -s 1 $host:pmcd.control.sighup | _filter

echo
echo "pmdumptext [metric spec in config file]"
echo $host:pmcd.control.sighup >$tmp.config
pmdumptext -t 0.5 -s 1 -c $tmp.config | _filter
