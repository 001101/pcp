#! /bin/sh
# PCP QA Test No. 646
# Testing of libpcp_mmv functionality (ondisk format)
#
# Copyright (c) 1995-2002 Silicon Graphics, Inc.  All Rights Reserved.
# Copyright (c) 2009 Aconex.  All Rights Reserved.
#
# creator
owner=nathans

seq=`basename $0`

echo "QA output created by $seq"

# get standard environment, filters and checks
. ./common.product
. ./common.filter
. ./common.check

tmp=/tmp/$$
here=`pwd`
sudo=$here/sudo
status=0	# success is the default!
$sudo rm -rf $tmp.* /var/tmp/mmv/test$$
trap "rm -f $tmp.*; $sudo rm -f /var/tmp/mmv/test$$; exit \$status" 0 1 2 3 15

src-oss/mmv_genstats test$$ &
pid=$!
wait
$PCP_PMDAS_DIR/mmv/mmvdump $PCP_TMP_DIR/mmv/test$$ | \
    sed \
	-e "s,test$$,testPID,g" \
	-e "s,^Process.*= $pid,Process    = PID,g" \
	-e "s,^Generated.*= $pid,Generated  = TIMESTAMP,g" \
	-e 's/interval = [0-9][0-9]*/interval = TIME/' \
	-e 's/eggs"] = [0-9][0-9]* (value=[0-9][0-9]*/eggs"] = N (value=N/' \

status=0
exit
