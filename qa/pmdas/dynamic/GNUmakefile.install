#!gmake
#
# Copyright (c) 2009 Aconex.  All Rights Reserved.
# 

SHELL	= sh

ifdef PCP_CONF
include $(PCP_CONF)
else
include $(PCP_DIR)/etc/pcp.conf
endif
include $(PCP_INC_DIR)/builddefs

# for cc replace all the -I<path> options with -I<run-time-include-dir>
# (need /.. at the end so #include <pcp/foo.h> works)
#
TMP             := $(CFLAGS:-I%=)
CFLAGS          = $(TMP) -I$(PCP_INC_DIR)/..

# for ld replace -L<build-time-dirs> with -L<run-time-lib-dir>
# and include -rpath in case $(PCP_LIB_DIR) is not on the
# default ld search path, e.g. for NetBSD
#
PCP_LIBS         = -L$(PCP_LIB_DIR) -rpath=$(PCP_LIB_DIR)

CFILES	= dynamic.c
INSTALLED_CMDTARGET = pmdadynamic
TARGETS = $(INSTALLED_CMDTARGET)
LDIRT	= *.log help.dir help.pag

LLDLIBS = -lpcp_pmda -lpcp $(LIB_FOR_MATH) $(LIB_FOR_DLOPEN) $(LIB_FOR_PTHREADS)

default default_pcp setup: $(TARGETS)

install install_pcp: default

include $(PCP_INC_DIR)/buildrules

pmdadynamic: dynamic.o
	$(CCF) -o $@ $(LDFLAGS) $< $(LDLIBS)
