#!/bin/sh
# PCP QA Test No. 752
# Test supported datetime strings

seq=`basename $0`
echo "QA output created by $seq"

# get standard environment, filters and checks
. ./common.product
. ./common.filter
. ./common.check

status=0	# success is the default!
$sudo rm -rf $tmp.* $seq.full
trap "rm -f $tmp.*; exit \$status" 0 1 2 3 15

export TZ=gmt
echo "now: $(date '+%Y-%m-%d')" >>$seq.full
echo "yesterday: $(date '+%Y-%m-%d' -d 'yesterday')" >>$seq.full
echo "tomorrow: $(date '+%Y-%m-%d' -d 'tomorrow')" >>$seq.full
echo "sunday: $(date '+%Y-%m-%d' -d 'sunday')" >>$seq.full
echo "first sunday: $(date '+%Y-%m-%d' -d 'first sunday')" >>$seq.full
echo "this sunday: $(date '+%Y-%m-%d' -d 'this sunday')" >>$seq.full
echo "next sunday: $(date '+%Y-%m-%d' -d 'next sunday')" >>$seq.full
echo "last sunday: $(date '+%Y-%m-%d' -d 'last sunday')" >>$seq.full
echo "tuesday: $(date '+%Y-%m-%d' -d 'tuesday')" >>$seq.full
echo "first tuesday: $(date '+%Y-%m-%d' -d 'first tuesday')" >>$seq.full
echo "this tuesday: $(date '+%Y-%m-%d' -d 'this tuesday')" >>$seq.full
echo "next tuesday: $(date '+%Y-%m-%d' -d 'next tuesday')" >>$seq.full
echo "last tuesday: $(date '+%Y-%m-%d' -d 'last tuesday')" >>$seq.full

# Be careful, sunday, first sunday, next sunday and today could all be
# the same date.
# Ditto for monday and tuesday.
#
src/rtimetest \
| tee -a $seq.full \
| sed \
    -e "/sunday/s/$(date '+%Y-%m-%d' -d 'sunday') ..:..:../SUNDAY/" \
    -e "/first sunday/s/$(date '+%Y-%m-%d' -d 'first sunday') ..:..:../FIRST SUNDAY/" \
    -e "/this sunday/s/$(date '+%Y-%m-%d' -d 'this sunday') ..:..:../THIS SUNDAY/" \
    -e "/next sunday/s/$(date '+%Y-%m-%d' -d 'next sunday') ..:..:../NEXT SUNDAY/" \
    -e "/last sunday/s/$(date '+%Y-%m-%d' -d 'last sunday') ..:..:../LAST SUNDAY/" \
    -e "/tuesday/s/$(date '+%Y-%m-%d' -d 'tuesday') ..:..:../TUESDAY/" \
    -e "/first tuesday/s/$(date '+%Y-%m-%d' -d 'first tuesday') ..:..:../FIRST TUESDAY/" \
    -e "/this tuesday/s/$(date '+%Y-%m-%d' -d 'this tuesday') ..:..:../THIS TUESDAY/" \
    -e "/next tuesday/s/$(date '+%Y-%m-%d' -d 'next tuesday') ..:..:../NEXT TUESDAY/" \
    -e "/last tuesday/s/$(date '+%Y-%m-%d' -d 'last tuesday') ..:..:../LAST TUESDAY/" \
    -e "s/$(date '+%Y-%m-%d' -d 'yesterday') ..:..:../YESTERDAY/" \
    -e "s/$(date '+%Y-%m-%d' -d 'tomorrow') ..:..:../TOMORROW/" \
    -e "s/$(date '+%Y-%m-%d') ..:..:../TODAY/"

unset TZ
pmval -Z 'America/Los_Angeles' -S '1998-8-6 02:00:00' sample.bin -a src/ok-foo
pmval -Z 'America/New_York' -S '1998-8-6 02:00:00' sample.bin -a src/ok-foo
