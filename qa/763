#!/bin/sh
# PCP QA Test No. 763
# Exercise slow PMDA connect_pmcd() method.
#
# Copyright (c) 2014 Ken McDonell.  All Rights Reserved.
#

seq=`basename $0`
echo "QA output created by $seq"

# get standard environment, filters and checks
. ./common.product
. ./common.filter
. ./common.check

status=1	# failure is the default!
$sudo rm -rf $tmp.* $seq.full
trap "cd $here; rm -rf $tmp.*; exit \$status" 0 1 2 3 15

cd pmdas/slow
$sudo make install >>$here/$seq.full 2>&1 
cd $PCP_VAR_DIR/pmdas/slow

# real QA test starts here
for start in 0 4 -4
do
    echo
    case "$start"
    in
	0)
	    echo "=== no start delay ==="
	    ;;
	-[0-9]*)
	    echo "=== start delay `expr -1 \* $start` sec, no connect_pmcd() ==="
	    ;;
	[0-9]*)
	    echo "=== start delay $start sec, using connect_pmcd() ==="
	    ;;
    esac
    cat <<End-of-File | $sudo ./Install
both
$start
End-of-File
    pminfo -f slow
done

# success, all done
status=0

exit
