#!/bin/bash

RANDOM_PASSWORD=`mktemp -u XXXXXXXXXX`

#test if easy_install is installed
easy_install -n -h 2>&1 >/dev/null
EASYINSTALL=$?

if [ $EASYINSTALL -eq 127 ]; then
    echo "Please install python virtualenv and re-run this script"
    exit
fi

easy_install buildbot-slave 2>/dev/null
EASYINSTALL=$?

if [ $EASYINSTALL -eq 1 ]; then
    echo "Please run this script with admin privileges (such as sudo or root)"
    exit
fi

if [ $EASYINSTALL -eq 0 ]; then
    echo "------------------------- PCP Buildbot --------------------------"
    echo ""
    echo "Please contact a PCP maintainer with your proposed buildslave name and password."
    echo "May we suggest a random password such as: $RANDOM_PASSWORD"
    echo "When you have been granted access, run your buildslave using the command:"
    echo "\`buildslave create-slave pcp-slave <domain-provided>:9989 example-slave $RANDOM_PASSWORD\`"
    echo "Please be sure to edit the subsequent info/host and info/admin files accordingly."
    exit
fi


